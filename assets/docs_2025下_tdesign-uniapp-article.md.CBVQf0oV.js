import{_ as a,c as s,o as e,a2 as t}from"./chunks/framework.CriqKoQt.js";const k=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2025下/tdesign-uniapp-article.md","filePath":"docs/2025下/tdesign-uniapp-article.md","lastUpdated":1768038011000}'),l={name:"docs/2025下/tdesign-uniapp-article.md"};function n(o,i,d,p,h,c){return e(),s("div",null,i[0]||(i[0]=[t(`<h2 id="_1-背景" tabindex="-1">1. 背景 <a class="header-anchor" href="#_1-背景" aria-label="Permalink to &quot;1. 背景&quot;">​</a></h2><p>跨端开发一直是前端领域的重要部分，旨在实现一套代码在多个平台运行。国内使用 <a href="https://uniapp.dcloud.net.cn/" target="_blank" rel="noreferrer">uniapp</a> 框架人数较多，一直有外部声音想要 uniapp 版本的 TDesign，如 TDesign Miniprogram 下的众多 <a href="https://github.com/Tencent/tdesign-miniprogram/issues?q=uniapp" target="_blank" rel="noreferrer">issue</a>。</p><img src="https://cdn.uwayfly.com/article/2025/10/own_mike_z2BC3Qi7FE8DNNWx.png" width="600"><p>原生小程序和 uniapp 有差异，有人在 uniapp 项目里用了原生小程序组件，需要魔改内部组件代码。</p><p>基于以上需求，写了 <a href="https://github.com/novlan1/tdesign-uniapp" target="_blank" rel="noreferrer">TDesign UniApp</a> 项目。支持：</p><ul><li>🌈 暗色模式</li><li>🌈 自定义主题</li><li>🌍 国际化</li><li>🚀 API 对齐官方</li><li>🚀 类型提示</li><li>...</li></ul><p>欢迎使用，欢迎 star，欢迎反馈！</p><ul><li>文档地址：<a href="https://uwayfly.com/tdesign-uniapp/" target="_blank" rel="noreferrer">https://uwayfly.com/tdesign-uniapp/</a></li><li>Github 地址：<a href="https://github.com/novlan1/tdesign-uniapp" target="_blank" rel="noreferrer">https://github.com/novlan1/tdesign-uniapp</a></li><li>NPM 地址: <a href="https://www.npmjs.com/package/tdesign-uniapp" target="_blank" rel="noreferrer">https://www.npmjs.com/package/tdesign-uniapp</a></li><li>DCloud 插件：<a href="https://ext.dcloud.net.cn/plugin?id=25431" target="_blank" rel="noreferrer">https://ext.dcloud.net.cn/plugin?id=25431</a></li></ul><h2 id="_2-预览" tabindex="-1">2. 预览 <a class="header-anchor" href="#_2-预览" aria-label="Permalink to &quot;2. 预览&quot;">​</a></h2><p>扫码查看 ↓</p><img src="https://cdn.uwayfly.com/tdesign-uniapp/tdesign-uniapp-qrcodes.png?a=3" width="600"><p>（注：其他平台同样支持，仅因平台审核等原因未能上架预览，不影响组件库正常使用。）</p><h2 id="_3-快速开始" tabindex="-1">3. 快速开始 <a class="header-anchor" href="#_3-快速开始" aria-label="Permalink to &quot;3. 快速开始&quot;">​</a></h2><h3 id="_3-1-安装" tabindex="-1">3.1. 安装 <a class="header-anchor" href="#_3-1-安装" aria-label="Permalink to &quot;3.1. 安装&quot;">​</a></h3><ol><li>NPM 方式</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tdesign-uniapp</span></span></code></pre></div><ol start="2"><li>UNI_MODULES 方式</li></ol><p>已上传<a href="https://ext.dcloud.net.cn/plugin?id=25431" target="_blank" rel="noreferrer">插件</a>到 DCloud 插件市场，请打开插件详情页并点击<code>使用 HBuilderX 导入插件</code>。</p><h3 id="_3-2-引入并使用" tabindex="-1">3.2. 引入并使用 <a class="header-anchor" href="#_3-2-引入并使用" aria-label="Permalink to &quot;3.2. 引入并使用&quot;">​</a></h3><ol><li><code>main.ts</code> 中引入样式文件</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;tdesign-uniapp/common/style/theme/index.css&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ol start="2"><li>在文件中使用</li></ol><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">t-loading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ts&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TLoading </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;tdesign-uniapp/loading/loading.vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="_3-3-自动导入" tabindex="-1">3.3. 自动导入 <a class="header-anchor" href="#_3-3-自动导入" aria-label="Permalink to &quot;3.3. 自动导入&quot;">​</a></h3><p>在 <code>pages.json</code> 配置 <a href="https://uniapp.dcloud.net.cn/collocation/pages.html#easycom" target="_blank" rel="noreferrer">easycom</a>，可实现自动导入。</p><ol><li>CLI 模式</li></ol><p>使用 CLI 模式，即使用 <code>node_modules</code> 下的 <code>tdesign-uniapp</code> 时，配置如下。</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;easycom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;^t-(.*)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tdesign-uniapp/$1/$1.vue&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ol start="2"><li>UNI_MODULES 模式</li></ol><p>使用 <code>uni_modules</code> 下的 <code>tdesign-uniapp</code> 时，配置如下。</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;easycom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;^t-(.*)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@/uni_modules/tdesign-uniapp/components/$1/$1.vue&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-4-平台兼容性" tabindex="-1">3.4. 平台兼容性 <a class="header-anchor" href="#_3-4-平台兼容性" aria-label="Permalink to &quot;3.4. 平台兼容性&quot;">​</a></h3><table tabindex="0"><thead><tr><th>平台</th><th>Vue2</th><th>Vue3</th><th>H5</th><th>Android</th><th>iOS</th><th>App-nvue</th><th>微信小程序</th><th>QQ小程序</th></tr></thead><tbody><tr><td><strong>支持情况</strong></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>⚠️</td><td>✅</td><td>✅</td></tr></tbody></table><table tabindex="0"><thead><tr><th>平台</th><th>支付宝小程序</th><th>抖音小程序</th><th>百度小程序</th><th>快手小程序</th><th>小红书小程序</th><th>京东小程序</th></tr></thead><tbody><tr><td><strong>支持情况</strong></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td></tr></tbody></table><h2 id="_4-浅思考" tabindex="-1">4. 浅思考 <a class="header-anchor" href="#_4-浅思考" aria-label="Permalink to &quot;4. 浅思考&quot;">​</a></h2><p>有几点是做之前要想清楚的。</p><h3 id="_4-1-为什么不做转换工具" tabindex="-1">4.1. 为什么不做转换工具 <a class="header-anchor" href="#_4-1-为什么不做转换工具" aria-label="Permalink to &quot;4.1. 为什么不做转换工具&quot;">​</a></h3><ol><li>工具转出来的可读性差，可维护性差</li><li>转换工具无法做到100%，总有些语法需要手动转换。这意味着一定会有人工介入</li><li>维护转换工具成本比维护组件库高好几倍，且写出来的还不一定就能完全满足</li><li>业务真正要用的是组件库，真正关心的也是组件库</li></ol><h3 id="_4-2-与-tdesign-miniprogram-版本关系" tabindex="-1">4.2. 与 tdesign-miniprogram 版本关系 <a class="header-anchor" href="#_4-2-与-tdesign-miniprogram-版本关系" aria-label="Permalink to &quot;4.2. 与 tdesign-miniprogram 版本关系&quot;">​</a></h3><p><code>tdesign-uniapp</code> 有独立的版本，并不与 <code>tdesign-miniprogram</code> 的版本相同。这是因为转换后的产物很有可能有自己的 <code>feature/bug</code>，处理需要发版，必然导致版本分叉。</p><p>多个 <code>tdesign-uniapp</code> 版本会对应一个 <code>tdesign-miniprogram</code> 版本，会尽量提供 <code>miniprogram</code> 最新版本的转换产物。</p><h3 id="_4-3-api-设计" tabindex="-1">4.3. API 设计 <a class="header-anchor" href="#_4-3-api-设计" aria-label="Permalink to &quot;4.3. API 设计&quot;">​</a></h3><p>API 一定要与官方一致，这是最不能妥协的，包括 <code>props</code>、<code>events</code>、事件参数，参数类型、插槽、CSS变量。</p><p>这样做的好处是，开发者没有额外心智负担，同时限制开发人员的胡乱发挥，以及减少开发者的决策成本。</p><p>API 尽量与小程序对齐，而不是 <code>mobile-vue/mobile-react</code>，因为 <code>uniapp</code> 语法主要是小程序的语法。</p><h3 id="_4-4-可维护性" tabindex="-1">4.4. 可维护性 <a class="header-anchor" href="#_4-4-可维护性" aria-label="Permalink to &quot;4.4. 可维护性&quot;">​</a></h3><ul><li>用统一的语法</li><li>不使用编译后的、混淆后的变量</li></ul><h2 id="_5-转化过程" tabindex="-1">5. 转化过程 <a class="header-anchor" href="#_5-转化过程" aria-label="Permalink to &quot;5. 转化过程&quot;">​</a></h2><h3 id="_5-1-核心转换逻辑" tabindex="-1">5.1. 核心转换逻辑 <a class="header-anchor" href="#_5-1-核心转换逻辑" aria-label="Permalink to &quot;5.1. 核心转换逻辑&quot;">​</a></h3><p>之前写过 Press UI，整体思路差不多。就是将小程序的 <code>wxml/wxss/js/json</code> 转成 uniapp 的 Vue，四个文件合成一个文件。以及将小程序的语法进行转化，以下是核心部分：</p><ol><li>uniComponent 包裹，内部有一些公共处理</li><li>properties =&gt; props</li><li>setData =&gt; data 正常赋值</li><li>生命周期改造</li><li>事件改造</li><li>props 文件改造，from: <code>value: ([^{]+)</code>，to: <code>default: $1</code></li></ol><p>其他部分，如 <code>externalClasses</code>、<code>relations</code>，以及组件库特有的受控属性、命令调用等都需要进行额外的处理。</p><h3 id="_5-2-事件参数" tabindex="-1">5.2. 事件参数 <a class="header-anchor" href="#_5-2-事件参数" aria-label="Permalink to &quot;5.2. 事件参数&quot;">​</a></h3><p><code>tdesign-miniprogram</code> 中的事件参数，在 <code>tdesign-uniapp</code> 中都被去掉了 <code>detail</code> 一层。以 Picker 组件为例，在 <code>tdesign-miniprogram</code> 中，这样获取参数</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onPickerChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e.detail.value);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在 <code>tdesign-uniapp</code> 中，需要去掉 <code>.detail</code>，即</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onPickerChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e.value);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这样做是为了简化使用。<code>tdesign-uniapp</code> 中所有组件都采用了这种方式。</p><h2 id="_6-细节" tabindex="-1">6. 细节 <a class="header-anchor" href="#_6-细节" aria-label="Permalink to &quot;6. 细节&quot;">​</a></h2><h3 id="_6-1-命令调用" tabindex="-1">6.1. 命令调用 <a class="header-anchor" href="#_6-1-命令调用" aria-label="Permalink to &quot;6.1. 命令调用&quot;">​</a></h3><p>tdesign-uniapp 中支持命令调用的组件有</p><ul><li>ActionSheet</li><li>Dialog</li><li>Message</li><li>Toast</li></ul><p>TDesign UniApp 下，命令调用的核心思路是数据转化，就是把所有 <code>props</code> 都声明成 <code>data</code>，比如 <code>visible</code> =&gt; <code>dataVisible</code>，这样组件自身才能既能从方法（<code>methods</code>）中得到值，又能从 <code>props</code> 中得到值。要改的地方包括</p><ol><li><code>data</code> 中初始化</li><li><code>watch</code> 中监听</li><li><code>setData</code> 收口，设置的时候都加上特殊开头</li></ol><p>每个组件具体实现不同。</p><ul><li>Message 嵌套了一层 <code>message-item</code>，<code>message-item</code> 没有 <code>props</code>，都是 <code>setData</code> 直接给的 <code>data</code>，所以根本不需要转换。 <ul><li>这是另一种解决思路了，用嵌套子组件，而不是转换数据。子组件一嵌套，且数据全部不走 <code>props</code>，而是调用子组件内部方法。</li><li>展示时， <code>setMessage</code>（组件调用、命令调用都走） =&gt; <code>addMessage</code> ( =&gt; <code>showMessageItem</code>) 或者 <code>updateMessage</code></li><li>Message 中的 <code>setMessage/addMessage/showMessageItem</code> 都是指的内部的 <code>message-item</code>，是循环的 <code>messageList</code>，而不是页面级别的 <code>t-message</code></li></ul></li><li>Dialog、ActionSheet 需要转换 <ul><li>调用 <code>setData</code>，将属性（包含 <code>visible: true</code>）传进去，同时将 <code>instance</code> 的 <code>_onConfirm</code> 设置为 <code>promise</code> 的 <code>resolve</code></li></ul></li><li>Toast 没有组件调用，只有命令式，无需数据转换。 <ul><li>调用 <code>instance.show</code>，内部还是 <code>setData</code></li></ul></li></ul><h3 id="_6-2-受控属性" tabindex="-1">6.2. 受控属性 <a class="header-anchor" href="#_6-2-受控属性" aria-label="Permalink to &quot;6.2. 受控属性&quot;">​</a></h3><p>存在受控属性的非表单组件有</p><ul><li>反馈类：ActionSheet、DropdownItem、Guide</li><li>展示类：CheckTag、Collapse、Image-viewer</li><li>导航类：Indexes、Sidebar、Steps、Tabbar、Tabs</li></ul><p>TDesign UniApp 中受控属性的处理，和小程序版本差不多。是将其转成 <code>data</code> 开头的内部属性，初始化的时候，会判断受控和非受控值。同时触发事件的时候也要判断当前是否存在受控属性，非受控的时候直接改变内部值并抛出事件，受控的时候只抛出事件。以及，<code>props</code> 中受控属性的默认值需是 <code>null</code> 或 <code>undefined</code>。</p><p>不同的是，小程序受控属性，可以使用 <code>this.setData({ [value]: this.defaultValue })</code>，也就是 <code>data</code> 中声明了一个和 <code>properties</code> 名称一样的变量，Vue 中不可以，会报错 <code>&#39;set&#39; on proxy: trap returned falsish for property &#39;value&#39;</code></p><p>总结下来，受控属性要处理的：</p><ol><li><code>watch</code> 中监听</li><li><code>created</code> 中初始化</li><li><code>methods</code> 中新增 <code>_trigger</code>，作为抛出事件的收口</li></ol><h3 id="_6-3-三方库" tabindex="-1">6.3. 三方库 <a class="header-anchor" href="#_6-3-三方库" aria-label="Permalink to &quot;6.3. 三方库&quot;">​</a></h3><p><code>tdesign-miniprogram</code> 执行 <code>npm run build</code>，在 <code>miniprogram_dist/node_modules</code> 目录下 拿到 <code>dayjs</code> 和 <code>tinycolor2</code> 的产物，复制到 <code>tdesign-uniapp</code> 的 <code>npm</code> 目录下，用啥拿啥 。</p><p>一次性工作，一般不会改。</p><h3 id="_6-4-input-受控" tabindex="-1">6.4. input 受控 <a class="header-anchor" href="#_6-4-input-受控" aria-label="Permalink to &quot;6.4. input 受控&quot;">​</a></h3><p>H5 下，uni-app 封装了 <code>input</code>，且不支持受控。</p><p>Input 限制中文字符在 uni-app 实现的话，解决方案是先设置一次，然后在 <code>nextTick</code> 中再设置一次。</p><p>参考：<a href="https://ask.dcloud.net.cn/article/39736" target="_blank" rel="noreferrer">https://ask.dcloud.net.cn/article/39736</a></p><p>其他方案：</p><ol><li>可以动态创建 <code>input</code> 元素，不用 uni-app 包裹的，缺点是更新属性麻烦。</li><li>动态计算 <code>maxlength</code>，用浏览器原生属性约束，缺点是实现稍复杂、代码量稍多。</li></ol><h3 id="_6-5-externalclass" tabindex="-1">6.5. externalClass <a class="header-anchor" href="#_6-5-externalclass" aria-label="Permalink to &quot;6.5. externalClass&quot;">​</a></h3><p>uni-app 下，<code>externalClasses</code> 是不生效的。</p><p>参考：</p><ul><li><a href="https://github.com/dcloudio/uni-app/issues/3275" target="_blank" rel="noreferrer">https://github.com/dcloudio/uni-app/issues/3275</a></li><li><a href="https://ask.dcloud.net.cn/question/163695" target="_blank" rel="noreferrer">https://ask.dcloud.net.cn/question/163695</a></li></ul><p>所以 <code>styleIsolation: apply-shared</code> 不够用，以只能改成 <code>styleIsolation: shared</code>，这样开发者才能在任意使用的地方覆盖组件样式。</p><p>可以改下 <code>packages/site/node_modules/@dcloudio/uni-mp-compiler/dist/transforms/transformComponent.js</code>，把 <code>isComponentProp</code> 方法，将 <code>t-class</code> 排除，就能解决，但是官方不会推出。</p><h3 id="_6-6-scoped" tabindex="-1">6.6. scoped <a class="header-anchor" href="#_6-6-scoped" aria-label="Permalink to &quot;6.6. scoped&quot;">​</a></h3><p>tdesign-uniapp 必须加 <code>scoped</code>，否则一个自定义组件加了 <code>styleIsolation: shared</code>，同一页面下其他没加此属性的自定义组件也会生效，只要 <code>class</code> 相同！</p><h3 id="_6-7-t-class" tabindex="-1">6.7. t-class <a class="header-anchor" href="#_6-7-t-class" aria-label="Permalink to &quot;6.7. t-class&quot;">​</a></h3><p>统一用 <code>tClass</code>，而不是 <code>class</code>。</p><img src="https://cdn.uwayfly.com/article/2025/10/own_mike_bR3Jm86QaWDeWRdD.png" width="600"><h3 id="_6-8-distancetop" tabindex="-1">6.8. distanceTop <a class="header-anchor" href="#_6-8-distancetop" aria-label="Permalink to &quot;6.8. distanceTop&quot;">​</a></h3><p>Drawer 顶部过高，是因为子组件 <code>popup</code> 中使用的 <code>--td-popup-distance-top</code> 变量为 <code>0</code>，这个变量由 <code>distanceTop</code> 生成，<code>distanceTop</code> 又是由 <code>using-custom-navbar</code> 这个 <code>mixin</code> 生成。</p><p><code>distanceTop</code> 由 <code>uni.getMenuButtonBoundingClientRect</code> 计算生成，H5 和 App 下没有这个API，可以直接传入 <code>customNavbarHeight</code>，这个值由业务自行计算得到。</p><p>目前使用到 <code>using-custom-navbar</code> 这个 <code>mixin</code> 的组件有</p><ul><li>Overlay，基础，使用到它的也会引用 <ul><li>Popup</li><li>Picker</li><li>ActionSheet</li><li>Calendar</li><li>Dialog</li><li>Drawer</li><li>Guide</li><li>Toast</li></ul></li><li>Fab</li><li>ImageViewer</li></ul><h3 id="_6-9-page-scroll" tabindex="-1">6.9. page-scroll <a class="header-anchor" href="#_6-9-page-scroll" aria-label="Permalink to &quot;6.9. page-scroll&quot;">​</a></h3><p>APP-PLUS 下，动态监听 <code>onPageScroll</code> 不生效，需要业务自己在页面中监听，下面给出最佳实践之一。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 页面 Vue 文件下，引入组件库提供的监听方法</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 该方法内部会通过 event-bus，传递参数给对应的组件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { handlePageScroll } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;tdesign-uniapp/mixins/page-scroll&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onPageScroll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handlePageScroll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>目前使用到 <code>page-scroll</code> 这个 <code>mixin</code> 的组件有</p><ol><li>Sticky</li><li>Indexes</li><li>Tabs(引入了 Sticky)</li></ol><p>示例页面有</p><ul><li>Fab</li><li>PullDownRefresh</li></ul><h3 id="_6-10-getcustomnavbarheight-报错" tabindex="-1">6.10. getCustomNavbarHeight 报错 <a class="header-anchor" href="#_6-10-getcustomnavbarheight-报错" aria-label="Permalink to &quot;6.10. getCustomNavbarHeight 报错&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cannot read properties of null (reading &#39;parentElement&#39;)</span></span></code></pre></div><img src="https://cdn.uwayfly.com/article/2025/10/own_mike_ycz2zafE5BbMiDDs.png" width="600"><p>这种就是 <code>mounted</code> 之后没延时，没获取到对应元素。</p><h3 id="_6-11-site-工程中的-alias" tabindex="-1">6.11. site 工程中的 alias <a class="header-anchor" href="#_6-11-site-工程中的-alias" aria-label="Permalink to &quot;6.11. site 工程中的 alias&quot;">​</a></h3><p>tdesign-uniapp 在 H5 下使用 <code>vite.config</code> 中的 <code>alias</code>，不使用 <code>workspace</code>，可解决修改组件后必须重启才能生效。</p><p>小程序下，这种方式需要进一步改造，只能引用同一个子工程，即不能跨 <code>src</code>，解决方案就是监听组件变动，同步复制到 <code>site</code> 工程下。</p><h3 id="_6-12-watch" tabindex="-1">6.12. watch <a class="header-anchor" href="#_6-12-watch" aria-label="Permalink to &quot;6.12. watch&quot;">​</a></h3><p>小程序的 <code>observers</code> 和 <code>vue</code> 的 <code>watch</code> 逻辑并不完全相同，小程序下，如果 <code>prop</code> 接收外部传入的实参与该 <code>prop</code> 的默认值不相等时，会导致 <code>observer</code> 被立即调用一次，Vue 而不是。</p><p><code>image</code> 中 <code>calcSize</code> 中就用到了。</p><h3 id="_6-13-auto-import" tabindex="-1">6.13. auto-import <a class="header-anchor" href="#_6-13-auto-import" aria-label="Permalink to &quot;6.13. auto-import&quot;">​</a></h3><p>开发了 auto-import-resolver 插件，但是发现微信小程序下编译有问题，H5 下正常，推测是 uniapp 自己的问题。</p><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_PEGTWZzYiQR36r7C.png" width="400"><p>可以使用 <a href="https://uniapp.dcloud.net.cn/collocation/pages.html#easycom" target="_blank" rel="noreferrer">easycom</a> 模式。</p><p>⚠️ 注意，<code>easycom</code> 不支持 <code>TIcon</code> 这种大驼峰，只能是 <code>t-icon</code>，这种中划线形式。</p><h3 id="_6-14-visible" tabindex="-1">6.14. visible <a class="header-anchor" href="#_6-14-visible" aria-label="Permalink to &quot;6.14. visible&quot;">​</a></h3><p>下面几个组件在关闭时，需要父组件中设置 <code>visible</code> 为 <code>false</code>，否则无法再次开启。也就是 <code>visible</code> 只能是受控的。可以给 <code>visible</code> 属性增加 <code>v-model</code> 语法糖。</p><ul><li>picker</li><li>drawer</li><li>cascader</li><li>calendar</li><li>date-time-picker</li><li>color-picker</li></ul><h2 id="_7-支付宝小程序" tabindex="-1">7. 支付宝小程序 <a class="header-anchor" href="#_7-支付宝小程序" aria-label="Permalink to &quot;7. 支付宝小程序&quot;">​</a></h2><h3 id="_7-1-styleisolation" tabindex="-1">7.1. styleIsolation <a class="header-anchor" href="#_7-1-styleisolation" aria-label="Permalink to &quot;7.1. styleIsolation&quot;">​</a></h3><p>支付宝小程序只支持在 <code>json</code> 文件中配置 <code>styleIsolation</code>，参考<a href="https://opendocs.alipay.com/mini/framework/component-template#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB" target="_blank" rel="noreferrer">文档</a>。</p><p>uni-app 会静态分析组件中的 <code>styleIsolation</code> 配置，放到组件对应的 <code>json</code> 文件中。源码地址：<a href="https://github.com/dcloudio/uni-app/tree/next/packages/uni-mp-vite/src/plugins/entry.ts" target="_blank" rel="noreferrer">packages/uni-mp-vite/src/plugins/entry.ts</a>。</p><p>正则表达式如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> styleIsolationRE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">defineOptions</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\s\\S]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*?</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">styleIsolation</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[&#39;&quot;]</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(isolated</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">apply-shared</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">shared)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[&#39;&quot;]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">export</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">default</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\s\\S]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*?</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">styleIsolation</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[&#39;|&quot;]</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(isolated</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">apply-shared</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">shared)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[&#39;|&quot;]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>所以，不能用 <code>uniComponent</code> 在运行时添加，只能在 Vue 中显式声明。</p><h3 id="_7-2-background" tabindex="-1">7.2. background <a class="header-anchor" href="#_7-2-background" aria-label="Permalink to &quot;7.2. background&quot;">​</a></h3><p>Stepper 中需显式声明 background 和 padding。</p><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_Hce7tsxzWisb4MXZ.png" width="500"><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_J8YPSmdtHBtKPQAs.png" width="500"><p>Search 中同样问题。</p><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_nPmaDZpdMnwrxGjm.png" width="500"><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_bBmbPbAYx7R8abDf.png" width="500"><h3 id="_7-3-disable-scroll" tabindex="-1">7.3. disable-scroll <a class="header-anchor" href="#_7-3-disable-scroll" aria-label="Permalink to &quot;7.3. disable-scroll&quot;">​</a></h3><p>滚动穿透问题，uniapp 有<a href="https://uniapp.dcloud.net.cn/tutorial/vue3-basics.html#%E4%BA%8B%E4%BB%B6%E4%BF%AE%E9%A5%B0%E7%AC%A6" target="_blank" rel="noreferrer">通用方案</a> <code>@touchmove.stop.prevent=&quot;noop&quot;</code>，支付宝下无效，需要设置 <code>disable-scroll</code>。参考<a href="https://opendocs.alipay.com/support/01rb9a" target="_blank" rel="noreferrer">文档</a>。</p><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_Rs2z2SHDRnm4a4aa.png" width="600"><p>⚠️ 注意，设置 <code>disable-scroll</code> 为 <code>true</code> 后，所有子元素的滚动都不能冒泡了，即便子元素设置的 <code>disable-scroll</code> 为 <code>false</code>，所以也尽可能减少 <code>disable-scroll</code> 属性的覆盖范围。</p><h3 id="_7-4-deep-编译问题" tabindex="-1">7.4. :deep 编译问题 <a class="header-anchor" href="#_7-4-deep-编译问题" aria-label="Permalink to &quot;7.4. :deep 编译问题&quot;">​</a></h3><p>避免 <code>less</code> 中两个 <code>:deep</code> 嵌套，其中一个不会被转化。</p><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_t6jQCkeSjhYc2AYz.png" width="500"><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_D643Bm7WjzhQX3jc.png" width="500"><h3 id="_7-5-scroll-view" tabindex="-1">7.5. scroll-view <a class="header-anchor" href="#_7-5-scroll-view" aria-label="Permalink to &quot;7.5. scroll-view&quot;">​</a></h3><p>微信小程序 <code>scroll-view</code>，宽度 <code>100%</code>。支付宝小程序不是，需手动设置，不设置的话，撑不开。</p><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_RYRrXDTrmrSdmCMh.png" width="500"><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_NpK4EZ3p78tsQNda.png" width="500"><h2 id="_8-抖音小程序" tabindex="-1">8. 抖音小程序 <a class="header-anchor" href="#_8-抖音小程序" aria-label="Permalink to &quot;8. 抖音小程序&quot;">​</a></h2><h3 id="_8-1-virtualhost" tabindex="-1">8.1. virtualHost <a class="header-anchor" href="#_8-1-virtualhost" aria-label="Permalink to &quot;8.1. virtualHost&quot;">​</a></h3><p>遇到一个点击事件不能传递的问题，排查下来以为是不能用 <code>uniComponent</code> 包裹，猜测其内部会静态检测 <code>js</code> 文件。后面发现是不能使用 <code>virtualHost: true</code>，不止 <code>button</code> 组件，其他组件也不一样。</p><h3 id="_8-2-样式穿透" tabindex="-1">8.2. 样式穿透 <a class="header-anchor" href="#_8-2-样式穿透" aria-label="Permalink to &quot;8.2. 样式穿透&quot;">​</a></h3><p>抖音小程序原生的话，可以用 <a href="https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/tutorial/custom-component/component-model-and-style#a6c4373d" target="_blank" rel="noreferrer">externalClasses</a> 来进行样式覆盖，但是前面提到过 uni-app 不支持。</p><p>它也不支持标签选择器，加上刚说的不能用 <code>virtualHost: true</code>，所以它的样式穿透是最麻烦的。</p><p>解决方案是，根据具体情况，对 <code>class/t-class/style/custom-style</code> 这些属性区分平台处理，比如</p><ul><li>DropdownItem 组件中，<code>btn</code> 用了 <code>class/t-class</code> 区分，<code>radio-group/checkbox-group</code> 用了 <code>custom-style</code></li><li>AvatarGroup 组件中，<code>avatar</code> 用了 <code>setStyle</code>（<code>children</code> 获取），因为 <code>avatar</code> 是外部定义的，无法用 <code>custom-style</code></li><li>涉及到伪类的只能用 <code>class</code>，不能用 <code>custom-style</code></li></ul><h3 id="_8-3-父子关系" tabindex="-1">8.3. 父子关系 <a class="header-anchor" href="#_8-3-父子关系" aria-label="Permalink to &quot;8.3. 父子关系&quot;">​</a></h3><p>抖音小程序给两个组件绑定父子关系也是最复杂的，其他小程序及H5可以通过 <code>provide/inject</code> 来收集 <code>parent</code>，抖音小程序中找不到（下面部分截图是放的 PressUI 组件库的）。</p><img src="https://cdn.uwayfly.com/article/2025/6/own_mike_HHa8HeNminHbpC3j.png" width="600"><p>这里想到一个办法是递归调用 <code>$parent</code>，找最近的一个和目标组件名称相同的 <code>parent</code>。比如 <code>picker-item</code> 中就找组件名称为 <code>TPicker</code> 最近的父组件。</p><p>但是，抖音小程序子孙组件的 <code>$parent</code> 竟然就是页面，页面的所有 <code>$children</code> 都是拉平的。基于此，想到的办法是从上往下遍历这个拉平的 <code>$children</code>，找距离子组件最近的一个父组件。</p><img src="https://cdn.uwayfly.com/article/2025/6/own_mike_bmwwwRjGpQYYHhf8.png" width="600"><img src="https://cdn.uwayfly.com/article/2025/6/own_mike_XSEkhMDNRdNmXEDp.png" width="600"><p>但是，页面的 <code>$children</code> 并不是&quot;父子父子父子..&quot;这样顺序排列的，而是&quot;父父父子子子...&quot;，导致 <code>$children</code> 收集有问题，要么多于实际，要么为空。</p><img src="https://cdn.uwayfly.com/article/2025/6/own_mike_b6aXQpMmPxh3naGG.png" width="600"><p>想到的办法是父子组件之间传递一个 <code>relationKey</code>，这个值是唯一的，找 <code>$parent</code> 时就不会找错了。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> findNearListParent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> temp;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> children) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> parentRelationKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.$props?.relationKey;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> thisRelationKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.$props?.relationKey;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (item.$options.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parentRelationKey </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> thisRelationKey) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      temp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> temp) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> temp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> temp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>上面的 <code>relationKey</code> 应该永远从业务传入。内部组件，不管父子，都只接受 <code>props</code>，不自己生产，减少复杂度。这样的话，不管用 <code>slot</code>， <code>&lt;x&gt;&lt;x-item&gt;&lt;/x&gt;</code> 还是用一个 <code>&lt;x&gt;</code>，都能保证 <code>relationKey</code> 同一个，且不论空还是不空，都是相等的。</p><p>此外，还有这种游离在依赖树之外的 <code>vm</code> 实例，也拿不到 <code>provide</code> 的值。</p><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_DZRyKmZBRZRA2B6k.png" width="600"><p>这种主要发生在 Popup 组件内部的父子关系，比如 <code>dropdown-menu</code> 组件中的 <code>radio-group/radio</code>、 <code>cascader</code> 组件 <code>tab</code> 模式的 <code>tabs/tab-panel</code>。</p><p>这种问题的一个解决方案是在使用它们的地方手动关联。</p><h3 id="_8-4-生命周期" tabindex="-1">8.4. 生命周期 <a class="header-anchor" href="#_8-4-生命周期" aria-label="Permalink to &quot;8.4. 生命周期&quot;">​</a></h3><p>Vue 中父子组件生命周期正常的执行顺序是：父组件先创建，然后子组件创建；子组件先挂载，然后父组件挂载，即“父beforeCreate-&gt; 父create -&gt; 子beforeCreate-&gt; 子created -&gt; 子mounted -&gt; 父mounted”。</p><p>抖音小程序并不遵循这样的规律。</p><img src="https://cdn.uwayfly.com/article/2025/6/own_mike_8rXrNdH7m6fmAaSd.png" width="600"><p>这个问题会导致父子组件的初始化数据出问题，之前在父组件 <code>mounted</code> 中执行的初始逻辑，都会因为还没收集完 <code>children</code>，而失败。</p><img src="https://cdn.uwayfly.com/article/2025/6/own_mike_d3M8XdYzTBxHSRzh.png" width="370"><p>解决办法有两种，可用延时，也可用回调。回调更安全，延时可能跟机器性能有关。回调就是在子组件 <code>mounted</code> 的时候调用父组件的数据初始化方法。</p><h2 id="_9-其他" tabindex="-1">9. 其他 <a class="header-anchor" href="#_9-其他" aria-label="Permalink to &quot;9. 其他&quot;">​</a></h2><h3 id="_9-1-最简单的" tabindex="-1">9.1. 最简单的 <a class="header-anchor" href="#_9-1-最简单的" aria-label="Permalink to &quot;9.1. 最简单的&quot;">​</a></h3><p><code>button</code> 不是最简单的，<code>loading/icon</code> 才是最简单的，它们是 <code>button</code> 的子元素。</p><h3 id="_9-2-组件归类" tabindex="-1">9.2. 组件归类 <a class="header-anchor" href="#_9-2-组件归类" aria-label="Permalink to &quot;9.2. 组件归类&quot;">​</a></h3><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_4fNtPMKtDajWBTyW.png" width="600"><p>导航类</p><ul><li>Navbar、Tabbar、Sidebar、Indexes 分别是上下左右四个方向的导航，固定</li><li>Drawer、BackTop 都是可隐藏的，点击某处或滑动到某处时才显示</li><li>Tabs 是业务中最常用的导航类组件，Steps 比 Tabs 更苛刻，有顺序，这两都以 <code>s</code> 结尾</li></ul><p>反馈类</p><ul><li>Overlay、Popup、Loading 基础</li><li>Message、Toast、Dialog、NoticeBar 是一类，Message 上+动态，Toast 中间，Dialog 中间，更重，NoticeBar 上+固定</li><li>DropdownMenu、ActionSheet 一个从上往下显示，一个从下往上</li><li>SwipeCell，PulldownRefresh 一个向左滑，一个向下滑</li><li>Guide 特殊，全局，其他的都是局部</li></ul><p>输入类</p><ul><li>Input、Textarea、Search，文字输入</li><li>Radio、Checkbox、Switch，点击选择</li><li>Stepper、Slider，数字选择（输入）一个是点击，一个是滑动</li><li>Picker，Cascader、TreeSelect，滑动选择</li><li>Calendar、DatetimePicker，特殊场景</li><li>ColorPicker，特殊场景</li><li>Rate，特殊场景</li><li>Upload，特殊场景</li></ul><h3 id="_9-3-野蛮生长" tabindex="-1">9.3. 野蛮生长 <a class="header-anchor" href="#_9-3-野蛮生长" aria-label="Permalink to &quot;9.3. 野蛮生长&quot;">​</a></h3><p>只有流量大的、用户多的APP，才可能有小程序。国内小程序生态百花齐放，没有两个是完全一样的。每一种小程序框架、文档、运营平台、开发者工具、审核等都需要不少的工作量、不少的人力。看得出来中国互联网过去几年发展的可以。</p><h3 id="_9-4-图标" tabindex="-1">9.4. 图标 <a class="header-anchor" href="#_9-4-图标" aria-label="Permalink to &quot;9.4. 图标&quot;">​</a></h3><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_4mZKcT6zYQNyJjrB.png" width="600"><p>上面是几个小程序开发者工具的图标</p><ul><li>微信/qq、支付宝、百度（BAT）</li><li>抖音、快手、小红书（分享社区）</li><li>京东</li></ul><p>有意思的是，大家想的都差不多</p><ol><li>体现连接 <ul><li>抖音，平面</li><li>京东，立体</li><li>快手，横向</li><li>百度，中间</li></ul></li><li>代码符号 <ul><li>支付宝</li><li>小红书</li><li>微信（结合了自己的 logo）</li></ul></li><li>产品 logo 变形 <ul><li>QQ</li><li>微信</li></ul></li></ol><h3 id="_9-5-wxcomponent" tabindex="-1">9.5. wxComponent <a class="header-anchor" href="#_9-5-wxcomponent" aria-label="Permalink to &quot;9.5. wxComponent&quot;">​</a></h3><p><code>tdesign-miniprogram</code> 中 <code>wxComponent</code> 类的作用：</p><ol><li>属性，处理受控属性，增加 <code>default*</code> 属性的默认值，增加 <code>style/customStyle</code> 属性，增加 <code>aria*</code> 相关属性</li><li><code>externalClasses</code>，增加 <code>class</code></li><li>方法，增加 <code>_trigger</code>，兼容受控情况下的抛出事件，非生命周期函数挂载在 <code>methods</code> 对象上</li><li>生命周期函数放到 <code>lifetimes</code> 上</li></ol><h3 id="_9-6-uni-app" tabindex="-1">9.6. uni-app <a class="header-anchor" href="#_9-6-uni-app" aria-label="Permalink to &quot;9.6. uni-app&quot;">​</a></h3><p><code>src/core/runtime/mp/polyfill/index.js</code></p><p>uni-app 中运行时对 <code>vant-weapp</code> 的 <code>polyfill</code> 核心逻辑</p><h3 id="_9-7-data" tabindex="-1">9.7. data <a class="header-anchor" href="#_9-7-data" aria-label="Permalink to &quot;9.7. data&quot;">​</a></h3><p><strong>只要不在模板中使用</strong>，<code>data</code> 不用提前声明，<code>created</code> 中动态声明即可</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">created</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.xxx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_9-8-slider-组件细节" tabindex="-1">9.8. Slider 组件细节 <a class="header-anchor" href="#_9-8-slider-组件细节" aria-label="Permalink to &quot;9.8. Slider 组件细节&quot;">​</a></h3><p>前置变量：</p><ul><li><code>initLeft = boxLeft - halfblock</code></li><li><code>initRight = boxRight - halfblock</code></li><li><code>maxRange = boxRight - boxLeft - blockSize - 6</code> ( 6 是边框)</li></ul><p><code>capsule</code> 模式下：</p><ol><li>左边滑块滑动，<code>offset = blockSize + 3</code>，<code>currentLeft = clientLeft - initLeft - offset</code>，就是 <code>clientLeft - boxLeft - halfBlock - 3</code></li><li>右边滑动滑动，<code>offset = - 3</code>，<code>currentIRight = -(clientRight - initRight - offset)</code>，就是 <code>boxRight - clientRight - halfBlock - 3</code></li></ol><p>假设 <code>boxLeft = 0</code>，<code>boxRight = 100</code>, <code>halfBlock = 10</code>,</p><ul><li>左就是 <code>clientLeft - 13</code>，左边最小是 13</li><li>右就是 <code>87 - clientRight</code>，右边最大是 87</li><li><code>maxRange</code> 就是 74</li></ul><img src="https://cdn.uwayfly.com/article/2025/11/own_mike_mDk26PEERn43wxNX.png" width="600"><p>图中分别是左、右、边框。</p><h2 id="_10-反馈" tabindex="-1">10. 反馈 <a class="header-anchor" href="#_10-反馈" aria-label="Permalink to &quot;10. 反馈&quot;">​</a></h2><p>有任何问题，建议通过 <a href="https://github.com/novlan1/tdesign-uniapp/issues" target="_blank" rel="noreferrer">Github issues</a> 反馈或扫码加入用户微信群。</p><img src="https://raw.githubusercontent.com/Tencent/tdesign/main/packages/site-components/src/images/groups/wx-group.png" width="200"><h2 id="_11-总结" tabindex="-1">11. 总结 <a class="header-anchor" href="#_11-总结" aria-label="Permalink to &quot;11. 总结&quot;">​</a></h2><blockquote><p>TDesign is an artwork.</p></blockquote><p>向 TDesign 的开发者致敬🫡。</p><p>后续规划是</p><ol><li>同步 TDesign Miniprogram 改动，尽量在小程序版本发布后的一周内，同步改动到 uniapp 版本上</li><li>兼容调试更多平台</li><li>模板工程等</li></ol><hr><p>注，本文发布于非工作时间。</p>`,227)]))}const g=a(l,[["render",n]]);export{k as __pageData,g as default};
