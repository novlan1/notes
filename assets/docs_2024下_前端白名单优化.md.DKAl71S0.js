import{_ as a,c as o,o as t,ag as d}from"./chunks/framework.6d7lLjym.js";const h=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2024下/前端白名单优化.md","filePath":"docs/2024下/前端白名单优化.md","lastUpdated":1746093153000}'),l={name:"docs/2024下/前端白名单优化.md"};function i(r,e,p,n,c,s){return t(),o("div",null,e[0]||(e[0]=[d('<h3 id="_1-开始" tabindex="-1">1. 开始 <a class="header-anchor" href="#_1-开始" aria-label="Permalink to &quot;1. 开始&quot;">​</a></h3><p>前端相关的白名单包括游戏内测试入口、现网vConsole、现网添加虚拟队员等。</p><p>当前白名单管理存在以下问题：</p><ol><li><p>没有有效期控制，离职人员、外部临时测试人员拥有无限期的入口访问权限</p></li><li><p>只有 <code>opened</code>，没有姓名（身份）与<code>openid</code>的对应关系</p></li><li><p>所有游戏的入口白名单是同一份，一个外部测试人员想开王者的入口，结果所有游戏的入口都开了</p></li></ol><p>由于当前的白名单没有清理机制，而人员变动又较频繁，所以很可能被某些人恶意截图、录屏发到网上。一旦发生，可能泄漏业务敏感信息、影响游戏人生的口碑，并且由于是游戏内入口，甚至可能影响到游戏。</p><h3 id="_2-设计" tabindex="-1">2. 设计 <a class="header-anchor" href="#_2-设计" aria-label="Permalink to &quot;2. 设计&quot;">​</a></h3><p>原则为安全、简单、易扩展。</p><ul><li>独立的申请、审批、删除、查看，可以放在前端研发平台</li><li>前端管理原始数据，页面可以请求COS数据进行白名单检验，也可以请求后台接口，后台依据此COS数据，判断权限</li></ul><h3 id="_3-实现" tabindex="-1">3. 实现 <a class="header-anchor" href="#_3-实现" aria-label="Permalink to &quot;3. 实现&quot;">​</a></h3><p>由于 myoa 创建单据回调地址只能是 oa 区或者 idc 区，当前前端管理的服务器基本是 devnet，所以自行创建 myoa 单据并不可行。这里借助了蓝盾流水线。</p><ol><li>用户在研发平台申请，研发平台后台远程调用蓝盾流水线，等待审批。同时生成操作记录、白名单单据</li><li>审批通过后，回调给研发平台后台。研发平台后台将修改白名单单据状态、操作记录状态，以及修改COS数据</li><li>管理定时任务，根据单据有效期、申请时间判读是否过期，清理过期时间，并更新COS数据</li></ol><p>这里为了简单用了COS数据，每种不同的权限类型（区分游戏）有不同的COS文件。COS文件为了保护隐私只放 Open Id，如果还是担心有风险，可进一步 md5 加密。甚至可以走后台，后台读取此文件，判断是否为白名单。</p><p>权限类型列表（区分游戏）、审批人、COS文件名等都放到七彩石维护，不同权限（区分游戏）审批人都可以单独设置。</p><p>每次权限变动都发送机器人通知，避免预期之外的变动。</p><p>细节部分，openId 和权限类型是主键，每次创建单据，都检查库里有没有，没有的话，直接入库。有的话，并且 <code>status</code> 是 <code>pending</code>，则报错单据已存在，如果 <code>status</code> 不是 <code>pending</code>，则更新这条单据的其他信息，尤其是 <code>status</code> 更新为 <code>pending</code>。</p><h3 id="_4-申请地址" tabindex="-1">4. 申请地址 <a class="header-anchor" href="#_4-申请地址" aria-label="Permalink to &quot;4. 申请地址&quot;">​</a></h3><p>研发平台申请入口<a href="https://mobile.a.com/rd-platform-web/#/management/white/new" target="_blank" rel="noreferrer">点击这里</a>，非研发平台用户（访客）也可以申请，。</p>',17)]))}const m=a(l,[["render",i]]);export{h as __pageData,m as default};
