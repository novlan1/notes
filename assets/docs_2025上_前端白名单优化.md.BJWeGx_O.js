import{_ as a,c as o,o as d,ag as t}from"./chunks/framework.6d7lLjym.js";const _=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2025上/前端白名单优化.md","filePath":"docs/2025上/前端白名单优化.md","lastUpdated":1746765936000}'),i={name:"docs/2025上/前端白名单优化.md"};function c(r,e,n,l,p,h){return d(),o("div",null,e[0]||(e[0]=[t('<h3 id="_1-开始" tabindex="-1">1. 开始 <a class="header-anchor" href="#_1-开始" aria-label="Permalink to &quot;1. 开始&quot;">​</a></h3><p>前端相关的白名单包括游戏内测试入口、现网vConsole、现网添加虚拟队员等。</p><p>当前白名单管理存在以下问题：</p><ol><li><p>没有有效期控制，离职人员、外部临时测试人员拥有无限期的入口访问权限</p></li><li><p>只有 <code>opened</code>，没有姓名（身份）与<code>openid</code>的对应关系</p></li><li><p>所有游戏的入口白名单是同一份，一个外部测试人员想开王者的入口，结果所有游戏的入口都开了</p></li></ol><p>由于当前的白名单没有清理机制，而人员变动又较频繁，所以很可能被某些人恶意截图、录屏发到网上。一旦发生，可能泄漏<strong>业务敏感信息、影响团队的口碑，并且由于是游戏内入口，甚至可能影响到游戏</strong>。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/5/own_mike_tAJ5QMD5Z2rr5AeS.png" width="400"><h3 id="_2-设计" tabindex="-1">2. 设计 <a class="header-anchor" href="#_2-设计" aria-label="Permalink to &quot;2. 设计&quot;">​</a></h3><p>由于存在以上问题，重新做了下白名单管理。设计原则为<strong>安全、简单、易扩展</strong>。</p><ul><li>独立的申请、审批、删除、查看，可以放在前端研发平台</li><li>前端管理原始数据，页面可以请求COS数据进行白名单检验，也可以请求后台接口，后台依据此COS数据，判断权限</li></ul><h3 id="_3-实现" tabindex="-1">3. 实现 <a class="header-anchor" href="#_3-实现" aria-label="Permalink to &quot;3. 实现&quot;">​</a></h3><p>由于 <code>myoa</code> 创建单据回调地址只能是 <code>oa</code> 区或者 <code>idc</code> 区，当前前端管理的服务器基本是在 <code>devnet</code>，且公司安全限制 <code>oa</code> 和 <code>devent</code> 不能互通。所以自行创建 <code>myoa</code> 单据并不可行。这里借助了蓝盾流水线。</p><ol><li>用户在研发平台申请，研发平台后台远程调用蓝盾流水线，等待审批。同时生成操作记录、白名单单据</li><li>审批通过后，回调给研发平台后台。研发平台后台将修改白名单单据状态、操作记录状态，以及修改COS数据</li><li>管理定时任务，根据单据有效期、申请时间判读是否过期，清理过期时间，并更新COS数据</li></ol><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/5/own_mike_cWpmWYSWGSjG3r6d.png" width="600"><p>这里为了简单用了COS数据，每种不同的权限类型（区分游戏）有不同的COS文件。COS文件为了保护隐私只放 Open Id，如果还是担心有风险，可进一步 <code>md5</code> 加密。甚至可以走后台，后台读取此文件，判断是否为白名单。</p><p>权限类型列表（区分游戏）、审批人、COS文件名等都放到七彩石维护，不同权限（区分游戏）审批人都可以单独设置。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/5/own_mike_EPywRB6rjbNz4rCz.png" width="400"><p>每次权限变动都发送机器人通知，避免预期之外的变动。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/5/own_mike_2F7tJSae8YJHFiiW.png" width="400"><p>细节部分，<code>openId</code> 和权限类型是主键，每次创建单据，都检查库里有没有，没有的话，直接入库。有的话，并且 <code>status</code> 是 <code>pending</code>，则报错单据已存在，如果 <code>status</code> 不是 <code>pending</code>，则更新这条单据的其他信息，尤其是 <code>status</code> 更新为 <code>pending</code>。</p><h3 id="_4-申请地址" tabindex="-1">4. 申请地址 <a class="header-anchor" href="#_4-申请地址" aria-label="Permalink to &quot;4. 申请地址&quot;">​</a></h3><p>研发平台申请入口<a href="https://mobile.a.com/rd-platform-web/#/management/white/new" target="_blank" rel="noreferrer">点击这里</a>，有需要的可以自助申请。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/5/own_mike_nE4xNXWkeANziEnE.png" width="600"><h3 id="_5-常见问题" tabindex="-1">5. 常见问题 <a class="header-anchor" href="#_5-常见问题" aria-label="Permalink to &quot;5. 常见问题&quot;">​</a></h3><h4 id="_5-1-账户所属人的含义是什么" tabindex="-1">5.1. 账户所属人的含义是什么 <a class="header-anchor" href="#_5-1-账户所属人的含义是什么" aria-label="Permalink to &quot;5.1. 账户所属人的含义是什么&quot;">​</a></h4><p>不是所有人都有内网权限。你可以给自己申请，也可以<strong>根据业务需要</strong>给三方合作者、外部测试人员申请。账户所属人就是申请账号的拥有者，公司内的填企业微信名字，非公司内的填名字和所在单位。</p><h4 id="_5-2-openid-是哪个应用的" tabindex="-1">5.2. openId 是哪个应用的 <a class="header-anchor" href="#_5-2-openid-是哪个应用的" aria-label="Permalink to &quot;5.2. openId 是哪个应用的&quot;">​</a></h4><p>当前业务的。</p><p>由于端内测试入口都是 <code>ingame-page</code> 的子工程，也就是基本是 <code>pvpapp</code> 的。</p><p><code>vConsole</code> 权限则不一定是 <code>pvpapp</code>，可咨询<strong>想要验证业务的前端负责人</strong>。</p><h4 id="_5-3-openid-怎么获取" tabindex="-1">5.3. openId 怎么获取 <a class="header-anchor" href="#_5-3-openid-怎么获取" aria-label="Permalink to &quot;5.3. openId 怎么获取&quot;">​</a></h4><p>Cookie、接口请求的 <code>header</code> 参数、<code>tipAI</code>机器人等方式都可以查到，具体可咨询想要验证业务的前端负责人。</p><h4 id="_5-4-有效期最短为一天-有必要吗" tabindex="-1">5.4. 有效期最短为一天，有必要吗？ <a class="header-anchor" href="#_5-4-有效期最短为一天-有必要吗" aria-label="Permalink to &quot;5.4. 有效期最短为一天，有必要吗？&quot;">​</a></h4><p>很有必要。有些三方合作者、外部测试人员就只是想临时测试一下。</p><h4 id="_5-5-定时任务执行频率" tabindex="-1">5.5. 定时任务执行频率 <a class="header-anchor" href="#_5-5-定时任务执行频率" aria-label="Permalink to &quot;5.5. 定时任务执行频率&quot;">​</a></h4><p>当前每隔1小时处理一下，可根据实际需要进行调整。</p><h4 id="_5-6-vconsole-权限能否也根据业务区分" tabindex="-1">5.6. vConsole 权限能否也根据业务区分 <a class="header-anchor" href="#_5-6-vconsole-权限能否也根据业务区分" aria-label="Permalink to &quot;5.6. vConsole 权限能否也根据业务区分&quot;">​</a></h4><p>业务可根据自身安全需要，进行权限类型的扩展。具体步骤：</p><ol><li>在七彩石配置下权限类型、COS文件信息</li><li>研发平台申请相应权限</li><li>业务配置文件增加 <code>vConsole.checkWhiteCosUrl</code> 配置</li></ol><p>有需要的找 guowangyang 扩展。</p><h4 id="_5-7-可以在手机上申请权限吗" tabindex="-1">5.7. 可以在手机上申请权限吗 <a class="header-anchor" href="#_5-7-可以在手机上申请权限吗" aria-label="Permalink to &quot;5.7. 可以在手机上申请权限吗&quot;">​</a></h4><p>申请入口可以在手机上打开。需先开启远程办公。</p><h4 id="_5-8-在哪里查看是否已经通过" tabindex="-1">5.8. 在哪里查看是否已经通过 <a class="header-anchor" href="#_5-8-在哪里查看是否已经通过" aria-label="Permalink to &quot;5.8. 在哪里查看是否已经通过&quot;">​</a></h4><p>有个通知群，找 guowangyang 拉进去。</p><h4 id="_5-9-审核通过后多久能生效" tabindex="-1">5.9. 审核通过后多久能生效 <a class="header-anchor" href="#_5-9-审核通过后多久能生效" aria-label="Permalink to &quot;5.9. 审核通过后多久能生效&quot;">​</a></h4><p>5分钟之内。</p>',45)]))}const m=a(i,[["render",c]]);export{_ as __pageData,m as default};
