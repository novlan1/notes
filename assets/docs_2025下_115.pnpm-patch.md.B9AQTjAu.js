import{_ as s,c as i,o as p,a2 as t}from"./chunks/framework.CriqKoQt.js";const r=JSON.parse('{"title":"pnpm patch 完整使用指南","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2025下/115.pnpm-patch.md","filePath":"docs/2025下/115.pnpm-patch.md","lastUpdated":1771452044000}'),e={name:"docs/2025下/115.pnpm-patch.md"};function n(h,a,l,o,c,d){return p(),i("div",null,a[0]||(a[0]=[t(`<h1 id="pnpm-patch-完整使用指南" tabindex="-1">pnpm patch 完整使用指南 <a class="header-anchor" href="#pnpm-patch-完整使用指南" aria-label="Permalink to &quot;pnpm patch 完整使用指南&quot;">​</a></h1><p><code>pnpm patch</code> 是 <code>pnpm</code> 提供的用于<strong>临时修改第三方依赖源码</strong>的核心命令，无需手动改动 <code>node_modules</code> 内的文件，修改会被妥善管理和复用，下面分步骤详细讲解。</p><h2 id="一、核心作用" tabindex="-1">一、核心作用 <a class="header-anchor" href="#一、核心作用" aria-label="Permalink to &quot;一、核心作用&quot;">​</a></h2><p><code>pnpm patch</code> 的核心作用是：<strong>临时修改项目中已安装的第三方 npm 依赖的源码</strong>，解决第三方依赖存在的 bug、满足个性化需求等场景，且修改后的内容可被跟踪和复用，避免直接修改 <code>node_modules</code> 导致的修改丢失、团队协作不一致等问题。</p><h2 id="二、完整使用步骤" tabindex="-1">二、完整使用步骤 <a class="header-anchor" href="#二、完整使用步骤" aria-label="Permalink to &quot;二、完整使用步骤&quot;">​</a></h2><h3 id="步骤1-生成依赖的可编辑副本" tabindex="-1">步骤1：生成依赖的可编辑副本 <a class="header-anchor" href="#步骤1-生成依赖的可编辑副本" aria-label="Permalink to &quot;步骤1：生成依赖的可编辑副本&quot;">​</a></h3><p>首先，针对已安装的依赖，生成一个可编辑的临时副本，命令格式如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基本用法：pnpm patch &lt;package-name&gt;[@&lt;version&gt;]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> patch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lodash</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 不指定版本（默认当前项目安装的版本）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> patch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> axios@1.6.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 指定具体版本（适用于多版本共存场景）</span></span></code></pre></div><p>执行命令后，pnpm 会输出两个关键信息：</p><ol><li>临时编辑目录的路径（类似 <code>/tmp/xxx/lodash</code>）</li><li>后续需要执行的 <code>pnpm patch-commit &lt;临时目录路径&gt;</code> 命令（需留存）</li></ol><p>此时，你可以进入该临时目录，对依赖的源码进行任意修改（修改逻辑和普通项目开发一致）。</p><h3 id="步骤2-提交修改并生成-patch-文件" tabindex="-1">步骤2：提交修改并生成 patch 文件 <a class="header-anchor" href="#步骤2-提交修改并生成-patch-文件" aria-label="Permalink to &quot;步骤2：提交修改并生成 patch 文件&quot;">​</a></h3><p>当你在临时目录中完成源码修改后，通过以下命令提交修改，生成对应的 patch 文件：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 格式：pnpm patch-commit &lt;临时编辑目录的路径&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> patch-commit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/xxx/lodash</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 路径替换为步骤1输出的实际路径</span></span></code></pre></div><p>执行该命令后，pnpm 会在项目根目录下自动创建 <code>patches</code> 文件夹，并在其中生成一个 patch 文件（命名格式类似 <code>lodash@4.17.21.patch</code>），该文件记录了你的所有修改差异，可被 Git 跟踪。</p><h3 id="步骤3-让项目自动应用-patch-修改" tabindex="-1">步骤3：让项目自动应用 patch 修改 <a class="header-anchor" href="#步骤3-让项目自动应用-patch-修改" aria-label="Permalink to &quot;步骤3：让项目自动应用 patch 修改&quot;">​</a></h3><p>修改 <code>package.json</code> 文件，在其中添加 <code>pnpm.patchedDependencies</code> 字段，指定需要应用 patch 的依赖及对应的 patch 文件路径，格式如下：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-project&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;pnpm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;patchedDependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;lodash@4.17.21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./patches/lodash@4.17.21.patch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;axios@1.6.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./patches/axios@1.6.0.patch&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 多个依赖可依次添加</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>添加完成后，执行以下命令，pnpm 会自动应用 patch 修改到项目的 <code>node_modules</code> 中：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 或简写 pnpm i</span></span></code></pre></div><p>此时，项目运行时会使用你修改后的依赖源码，而非原始的依赖包内容。</p><h3 id="步骤4-修改后的更新-维护-可选" tabindex="-1">步骤4：修改后的更新/维护（可选） <a class="header-anchor" href="#步骤4-修改后的更新-维护-可选" aria-label="Permalink to &quot;步骤4：修改后的更新/维护（可选）&quot;">​</a></h3><ol><li>若需要再次修改该依赖：重复步骤1-3，新的 patch 文件会覆盖旧文件（或生成新文件，需同步更新 <code>package.json</code> 中的路径）</li><li>若需要取消 patch 修改：删除 <code>package.json</code> 中对应的 <code>patchedDependencies</code> 配置，删除对应的 patch 文件，再执行 <code>pnpm install</code> 即可恢复原始依赖</li><li>团队协作：将 <code>patches</code> 文件夹和 <code>package.json</code> 提交到 Git 仓库，其他团队成员拉取代码后执行 <code>pnpm install</code>，会自动应用 patch 修改，无需额外操作</li></ol><h2 id="三、补充说明" tabindex="-1">三、补充说明 <a class="header-anchor" href="#三、补充说明" aria-label="Permalink to &quot;三、补充说明&quot;">​</a></h2><ol><li>适用场景：临时修复第三方依赖 bug、个性化定制依赖功能、验证依赖修改效果等，不推荐长期依赖（长期需求建议提 PR 给依赖作者或 fork 后自行维护）</li><li>版本兼容性：<code>pnpm patch</code> 要求 pnpm 版本 ≥ 6.22.0，若版本过低，可通过 <code>pnpm add -g pnpm</code> 升级</li><li>注意事项：修改依赖源码时，尽量保持代码风格一致，避免破坏依赖的原有功能；若依赖后续升级，需重新验证 patch 是否兼容</li></ol><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><ol><li><code>pnpm patch &lt;包名&gt;</code>：生成可编辑的依赖副本</li><li><code>pnpm patch-commit &lt;临时路径&gt;</code>：提交修改生成 patch 文件</li><li><code>package.json</code> 配置 <code>pnpm.patchedDependencies</code>：关联依赖与 patch 文件</li><li><code>pnpm install</code>：自动应用 patch 修改，团队协作无缝同步</li></ol><hr><p>有时候不能修改 <code>package.json</code>，否则流水线编译不过。<code>pnpm-lock.yaml</code> 有记录这个 <code>patch</code> 信息就够了。</p>`,29)]))}const g=s(e,[["render",n]]);export{r as __pageData,g as default};
