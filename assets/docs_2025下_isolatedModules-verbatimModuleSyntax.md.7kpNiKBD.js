import{_ as i,c as a,o as e,a2 as t}from"./chunks/framework.CriqKoQt.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2025下/isolatedModules-verbatimModuleSyntax.md","filePath":"docs/2025下/isolatedModules-verbatimModuleSyntax.md","lastUpdated":1769935797000}'),l={name:"docs/2025下/isolatedModules-verbatimModuleSyntax.md"};function n(p,s,o,h,d,k){return e(),a("div",null,s[0]||(s[0]=[t(`<h2 id="_1-isolatedmodules" tabindex="-1">1. isolatedModules <a class="header-anchor" href="#_1-isolatedmodules" aria-label="Permalink to &quot;1. isolatedModules&quot;">​</a></h2><p>isolatedModules 是 TypeScript 配置中的一个重要选项，用于确保每个文件能够作为独立模块进行编译，不依赖其他模块的类型信息。以下是其核心含义和作用：</p><ol><li>基本定义</li></ol><p>• 作用：当设置为 true 时，强制每个文件必须显式使用 import 或 export 语句，否则会被视为全局脚本文件而报错。这确保了文件在独立编译时（如通过 Babel 或 esbuild）的类型安全性和可移植性。</p><p>• 报错示例：若文件未包含模块化语句（如 <code>export {}</code>），会提示错误：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>TS1208: Cannot compile under &#39;--isolatedModules&#39; because it is considered a global script file.。</span></span></code></pre></div><ol start="2"><li>解决的问题</li></ol><p>• Babel 兼容性：Babel 等工具在转译 TypeScript 时会移除类型，但无法分析跨文件的类型依赖。例如，若文件 b.ts 导出类型 Test 而未使用 export type，Babel 可能错误保留导出导致运行时错误。isolatedModules 强制使用 import/export type 明确类型依赖。</p><p>• 全局污染风险：未模块化的文件可能导致变量泄露到全局作用域，引发命名冲突。</p><ol start="3"><li>性能优化</li></ol><p>• 构建效率：在 Angular 等框架中，启用 isolatedModules 可让打包工具（如 esbuild）直接处理 TypeScript 代码，跳过类型检查器，提升构建速度（如 Angular 18.2 实测构建时间减少 10%）。</p><p>• 枚举优化：打包工具可内联常量枚举（const enum），减少运行时开销。</p><ol start="4"><li>配置建议</li></ol><p>• 推荐值：现代项目（尤其是使用 Babel 或 Vite 等工具时）建议设为 true。</p><p>• 关联配置：需配合 moduleResolution: &quot;node&quot; 或 &quot;bundler&quot;，并确保 target 和 module 为现代标准（如 esnext）。</p><ol start="5"><li>注意事项</li></ol><p>• 全局声明文件：.d.ts 文件不受此限制，但普通 .ts 文件必须模块化。</p><p>• 显式类型导出：跨文件类型引用需使用 import type 或 export type 以避免运行时问题。</p><p>通过启用 isolatedModules，开发者可以更好地适配现代工具链，同时避免潜在的模块化问题和性能瓶颈。</p><h2 id="_2-verbatimmodulesyntax" tabindex="-1">2. verbatimModuleSyntax <a class="header-anchor" href="#_2-verbatimmodulesyntax" aria-label="Permalink to &quot;2. verbatimModuleSyntax&quot;">​</a></h2><p>verbatimModuleSyntax 是 TypeScript 5.0 引入的一个重要编译选项，用于精确控制模块导入/导出语句在编译输出中的保留行为。以下是其核心含义和作用：</p><ol><li>基本功能</li></ol><p>• 原样保留模块语法：启用后（&quot;verbatimModuleSyntax&quot;: true），TypeScript 会严格保留源代码中的模块语法结构，不再自动移除仅包含类型引用的导入（如 import type），确保输出代码与输入代码的模块结构一致。</p><p>• 显式类型标记：强制开发者使用 import type 或 export type 明确区分类型与值的导入/导出，避免传统编译中类型导入被意外移除的问题。</p><ol start="2"><li>解决的问题</li></ol><p>• 构建工具兼容性：传统 TypeScript 编译会移除未用作值的类型导入，但像 Babel、Rolldown 等工具无法识别跨文件类型依赖，可能导致运行时错误。verbatimModuleSyntax 通过保留所有导入语句（包括类型导入）解决此问题。</p><p>• 副作用模块的保留：确保带有副作用的模块（如包含 <code>console.log</code> 的初始化代码）不会被错误移除，因为其导入语句会被完整保留。</p><ol start="3"><li>与旧选项的对比</li></ol><p>• 替代 importsNotUsedAsValues：此选项已被废弃，verbatimModuleSyntax 提供了更清晰的语义。例如，旧选项的 &quot;remove&quot; 或 &quot;preserve&quot; 行为被统一为严格的原样保留逻辑。</p><p>• 与 isolatedModules 的关系：两者均用于模块安全，但 isolatedModules 确保文件独立编译，而 verbatimModuleSyntax 进一步控制语法保留细节。现代配置常同时启用它们。</p><ol start="4"><li>典型应用场景</li></ol><p>• 现代构建工具链：与 Vite、esbuild 或 Rolldown 等工具配合时，需启用此选项以避免类型导入丢失。</p><p>• Node.js ESM 项目：原生 ESM 模块要求显式文件扩展名和精确的导入导出，verbatimModuleSyntax 能严格匹配此需求。</p><ol start="5"><li>配置示例</li></ol><p>在 tsconfig.json 中启用：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;verbatimModuleSyntax&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ESNext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;target&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;es2022&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>此配置适用于现代前端或 Node.js 项目，尤其推荐与 &quot;moduleResolution&quot;: &quot;NodeNext&quot; 或 &quot;bundler&quot; 搭配使用。</p><ol start="6"><li>注意事项</li></ol><p>• 副作用代码：需确保无用的类型导入不会意外引入副作用模块，必要时通过代码分割或动态导入优化。</p><p>• 迁移成本：从旧选项切换时，需检查项目中所有类型导入是否已显式标记为 type。</p><p>通过启用 verbatimModuleSyntax，开发者可以更精准地控制模块系统的行为，提升代码的跨工具兼容性和运行时可靠性。</p><hr><p>启用 <code>verbatimModuleSyntax: true</code> 后：</p><p>​1. 强制区分类型导入和值导入</p><ul><li>必须显式用 type 标记类型导入/导出</li><li>非类型导入/导出会 ​100% 保留 在编译后的代码中 ​</li></ul><ol start="2"><li>禁止隐式类型导入删除</li></ol><ul><li>如果没有 type 修饰符，TypeScript 会认为这是一个值导入，即使它看起来像类型 ​</li></ul><ol start="3"><li>更接近 ESM 的运行时行为</li></ol><ul><li>编译后的代码更接近原生 ES 模块的预期行为</li></ul><h2 id="_3-forceconsistentcasinginfilenames" tabindex="-1">3. forceConsistentCasingInFileNames <a class="header-anchor" href="#_3-forceconsistentcasinginfilenames" aria-label="Permalink to &quot;3. forceConsistentCasingInFileNames&quot;">​</a></h2><p>forceConsistentCasingInFileNames 是 TypeScript 编译器的一个选项（在 <code>tsconfig.json</code> 中配置），用于 ​强制文件名的大小写一致性。它的作用是避免在大小写敏感的操作系统（如 Linux、macOS）和大小写不敏感的系统（如 Windows）之间因文件名大小写不一致而导致的潜在问题。</p><p>forceConsistentCasingInFileNames 的作用:</p><ol><li>​启用后（true）​：TypeScript 会检查所有模块导入的路径是否和实际文件名的大小写完全一致，如果不一致，会直接报错。</li><li>禁用后（false，默认值）​：TypeScript 不会检查文件名大小写，可能导致跨平台兼容性问题。</li></ol><h2 id="_4-esmoduleinterop-作用" tabindex="-1">4. esModuleInterop 作用 <a class="header-anchor" href="#_4-esmoduleinterop-作用" aria-label="Permalink to &quot;4. esModuleInterop 作用&quot;">​</a></h2><p>启用 <code>esModuleInterop: true</code> 后，TypeScript 会：</p><ol><li>​自动生成兼容性代码：在编译后的 JavaScript 中插入辅助函数（<code>__importDefault</code>、<code>__importStar</code>），使 ES 模块的 import 语法能正确加载 CommonJS 模块。</li><li>放宽类型检查：允许直接使用 <code>import defaultExport from &#39;module&#39;</code> 语法导入 CommonJS 模块。</li></ol><p>未启用 esModuleInterop：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 必须用命名空间导入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>启用 esModuleInterop：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 可以直接默认导入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="_5-moduledetection" tabindex="-1">5. moduleDetection <a class="header-anchor" href="#_5-moduledetection" aria-label="Permalink to &quot;5. moduleDetection&quot;">​</a></h2><p>moduleDetection 允许你显式指定模块检测策略，避免隐式推断带来的问题。</p><p>默认行为的问题</p><p>在 TypeScript 4.x 及更早版本中，模块检测规则较为隐式：</p><ul><li>如果文件中有 import/export 语句，则视为 ESM。</li><li>否则视为 CommonJS（或全局脚本）。</li></ul><p>但这种规则在以下场景会出错：</p><ul><li>某些工具（如 Babel、Webpack）可能允许混合使用 ESM 和 CommonJS。</li><li>配置文件（如 .ts 中只有类型）可能被误判。</li></ul><img src="https://cdn.uwayfly.com/article/2025/8/own_mike_BQDnbBXsCN5SiAPA.jpg" width="600"><h2 id="_6-allowimportingtsextensions" tabindex="-1">6. allowImportingTsExtensions <a class="header-anchor" href="#_6-allowimportingtsextensions" aria-label="Permalink to &quot;6. allowImportingTsExtensions&quot;">​</a></h2><p>allowImportingTsExtensions 的作用</p><ol><li>false（默认）​：禁止在导入语句中使用 <code>.ts</code>、<code>.tsx</code>、<code>.mts</code> 或 <code>.cts</code> 扩展名。</li></ol><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { foo } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./file.ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 报错：无法导入 TS 扩展名文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">​</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\`\`</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2. true：允许在导入语句中显式使用 TypeScript 文件扩展名。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\`\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { foo } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./file.ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 允许（但需确保运行时支持）</span></span></code></pre></div><h2 id="_7-module" tabindex="-1">7. module <a class="header-anchor" href="#_7-module" aria-label="Permalink to &quot;7. module&quot;">​</a></h2><p>module 决定了：</p><ol><li>输出的 JavaScript 使用哪种模块标准（如 CommonJS、ES Modules 等）</li><li>如何转换 <code>import/export</code> 语法</li><li>是否生成兼容性代码（如 <code>require()</code> 或 <code>define()</code>）</li></ol><img src="https://cdn.uwayfly.com/article/2025/8/own_mike_SmjzTRw3mfEkMK3s.jpg" width="600"><img src="https://cdn.uwayfly.com/article/2025/8/own_mike_YXKb4yCRWmGebTfm.jpg" width="600"><h2 id="_8-usedefineforclassfields" tabindex="-1">8. useDefineForClassFields <a class="header-anchor" href="#_8-usedefineforclassfields" aria-label="Permalink to &quot;8. useDefineForClassFields&quot;">​</a></h2><p>useDefineForClassFields 的作用</p><p>​1. false（默认）​：类字段使用 <code>[[Set]]</code> 语义（<code>this.field = value</code>）。 ​2. true：类字段使用 <code>[[Define]]</code> 语义（<code>Object.defineProperty</code>），符合 ES2022+ 标准。</p><p>源代码</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Foo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>​编译后的 JavaScript ​</p><ol><li>useDefineForClassFields: false（默认）​</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Foo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// [[Set]] 语义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ol start="2"><li>​useDefineForClassFields: true</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Foo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defineProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// [[Define]] 语义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><img src="https://cdn.uwayfly.com/article/2025/8/own_mike_FdiGXZwNZbHW7WjX.jpg" width="600">`,88)]))}const u=i(l,[["render",n]]);export{c as __pageData,u as default};
