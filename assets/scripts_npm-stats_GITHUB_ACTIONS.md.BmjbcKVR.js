import{_ as l,c as a,o as t,a2 as o}from"./chunks/framework.CriqKoQt.js";const p=JSON.parse('{"title":"GitHub Actions 配置指南","description":"","frontmatter":{},"headers":[],"relativePath":"scripts/npm-stats/GITHUB_ACTIONS.md","filePath":"scripts/npm-stats/GITHUB_ACTIONS.md","lastUpdated":1771380904000}'),e={name:"scripts/npm-stats/GITHUB_ACTIONS.md"};function r(s,i,n,h,c,d){return t(),a("div",null,i[0]||(i[0]=[o(`<h1 id="github-actions-配置指南" tabindex="-1">GitHub Actions 配置指南 <a class="header-anchor" href="#github-actions-配置指南" aria-label="Permalink to &quot;GitHub Actions 配置指南&quot;">​</a></h1><p>本文档说明如何配置 GitHub Actions 来自动运行 NPM 下载量统计脚本。</p><h2 id="📋-工作流说明" tabindex="-1">📋 工作流说明 <a class="header-anchor" href="#📋-工作流说明" aria-label="Permalink to &quot;📋 工作流说明&quot;">​</a></h2><p>工作流文件位置：<code>.github/workflows/npm-stats.yml</code></p><h3 id="触发条件" tabindex="-1">触发条件 <a class="header-anchor" href="#触发条件" aria-label="Permalink to &quot;触发条件&quot;">​</a></h3><ol><li><p><strong>定时触发</strong>：每天早上 9:00（北京时间）自动执行</p><ul><li>Cron 表达式：<code>0 1 * * *</code>（UTC 时间 01:00，即北京时间 09:00）</li></ul></li><li><p><strong>手动触发</strong>：可以在 GitHub Actions 页面手动运行</p></li></ol><h3 id="工作流程" tabindex="-1">工作流程 <a class="header-anchor" href="#工作流程" aria-label="Permalink to &quot;工作流程&quot;">​</a></h3><ol><li>检出代码</li><li>设置 Node.js 环境（版本 20）</li><li>安装 pnpm</li><li>安装项目依赖</li><li>运行统计脚本</li><li>发送结果到企业微信</li></ol><h2 id="🔧-配置步骤" tabindex="-1">🔧 配置步骤 <a class="header-anchor" href="#🔧-配置步骤" aria-label="Permalink to &quot;🔧 配置步骤&quot;">​</a></h2><h3 id="第一步-添加-github-secret" tabindex="-1">第一步：添加 GitHub Secret <a class="header-anchor" href="#第一步-添加-github-secret" aria-label="Permalink to &quot;第一步：添加 GitHub Secret&quot;">​</a></h3><ol><li>打开 GitHub 仓库页面</li><li>点击 <strong>Settings</strong>（设置）</li><li>在左侧菜单中找到 <strong>Secrets and variables</strong> → <strong>Actions</strong></li><li>点击 <strong>New repository secret</strong> 按钮</li><li>添加以下密钥： <ul><li><strong>Name</strong>：<code>WX_ROBOT_KEY</code></li><li><strong>Value</strong>：你的企业微信机器人 Webhook Key（例如：<code>d7ac7b67-0960-4b15-a407-6d682ba77247</code>）</li></ul></li><li>点击 <strong>Add secret</strong> 保存</li></ol><h3 id="第二步-启用-github-actions" tabindex="-1">第二步：启用 GitHub Actions <a class="header-anchor" href="#第二步-启用-github-actions" aria-label="Permalink to &quot;第二步：启用 GitHub Actions&quot;">​</a></h3><ol><li>确保仓库的 Actions 功能已启用</li><li>进入 <strong>Actions</strong> 页面</li><li>如果是第一次使用，可能需要点击 &quot;I understand my workflows, go ahead and enable them&quot;</li></ol><h3 id="第三步-验证配置" tabindex="-1">第三步：验证配置 <a class="header-anchor" href="#第三步-验证配置" aria-label="Permalink to &quot;第三步：验证配置&quot;">​</a></h3><p>提交代码后，工作流会自动生效。你可以：</p><ol><li>等待定时任务自动执行（每天早上 9 点）</li><li>或者手动触发测试： <ul><li>进入 <strong>Actions</strong> 页面</li><li>选择 <strong>NPM Download Statistics</strong> 工作流</li><li>点击 <strong>Run workflow</strong> 按钮</li><li>选择分支（通常是 <code>master</code> 或 <code>main</code>）</li><li>点击绿色的 <strong>Run workflow</strong> 按钮</li></ul></li></ol><h2 id="📊-查看执行结果" tabindex="-1">📊 查看执行结果 <a class="header-anchor" href="#📊-查看执行结果" aria-label="Permalink to &quot;📊 查看执行结果&quot;">​</a></h2><h3 id="查看运行日志" tabindex="-1">查看运行日志 <a class="header-anchor" href="#查看运行日志" aria-label="Permalink to &quot;查看运行日志&quot;">​</a></h3><ol><li>进入 <strong>Actions</strong> 页面</li><li>点击具体的工作流运行记录</li><li>查看每个步骤的执行日志</li><li>如果成功，会在日志中看到 &quot;✅ 消息发送成功！&quot;</li></ol><h3 id="查看企业微信消息" tabindex="-1">查看企业微信消息 <a class="header-anchor" href="#查看企业微信消息" aria-label="Permalink to &quot;查看企业微信消息&quot;">​</a></h3><p>如果配置正确，统计报告会自动发送到企业微信群。</p><h2 id="⚙️-自定义配置" tabindex="-1">⚙️ 自定义配置 <a class="header-anchor" href="#⚙️-自定义配置" aria-label="Permalink to &quot;⚙️ 自定义配置&quot;">​</a></h2><h3 id="修改执行时间" tabindex="-1">修改执行时间 <a class="header-anchor" href="#修改执行时间" aria-label="Permalink to &quot;修改执行时间&quot;">​</a></h3><p>编辑 <code>.github/workflows/npm-stats.yml</code> 文件中的 cron 表达式：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">schedule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">cron</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;0 1 * * *&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # UTC 时间 01:00，即北京时间 09:00</span></span></code></pre></div><p>常用时间示例：</p><ul><li>每天早上 9:00（北京时间）：<code>0 1 * * *</code></li><li>每天中午 12:00（北京时间）：<code>0 4 * * *</code></li><li>每天晚上 18:00（北京时间）：<code>0 10 * * *</code></li><li>每周一早上 9:00（北京时间）：<code>0 1 * * 1</code></li></ul><h3 id="修改统计的包列表" tabindex="-1">修改统计的包列表 <a class="header-anchor" href="#修改统计的包列表" aria-label="Permalink to &quot;修改统计的包列表&quot;">​</a></h3><p>编辑 <code>scripts/npm-stats/npm-download-stats.js</code> 文件中的 <code>PACKAGES</code> 数组。</p><h3 id="添加多个机器人" tabindex="-1">添加多个机器人 <a class="header-anchor" href="#添加多个机器人" aria-label="Permalink to &quot;添加多个机器人&quot;">​</a></h3><p>如果需要发送到多个企业微信群：</p><ol><li>在 GitHub Secrets 中添加多个 Key（如 <code>WX_ROBOT_KEY_1</code>、<code>WX_ROBOT_KEY_2</code>）</li><li>修改脚本支持多个机器人</li></ol><h2 id="🐛-故障排查" tabindex="-1">🐛 故障排查 <a class="header-anchor" href="#🐛-故障排查" aria-label="Permalink to &quot;🐛 故障排查&quot;">​</a></h2><h3 id="问题-1-工作流没有自动执行" tabindex="-1">问题 1：工作流没有自动执行 <a class="header-anchor" href="#问题-1-工作流没有自动执行" aria-label="Permalink to &quot;问题 1：工作流没有自动执行&quot;">​</a></h3><p><strong>可能原因</strong>：</p><ul><li>GitHub Actions 未启用</li><li>仓库长期未活动（GitHub 会自动禁用）</li><li>Cron 表达式错误</li></ul><p><strong>解决方法</strong>：</p><ul><li>检查 Actions 是否启用</li><li>手动触发一次工作流</li><li>验证 cron 表达式是否正确</li></ul><h3 id="问题-2-消息发送失败" tabindex="-1">问题 2：消息发送失败 <a class="header-anchor" href="#问题-2-消息发送失败" aria-label="Permalink to &quot;问题 2：消息发送失败&quot;">​</a></h3><p><strong>可能原因</strong>：</p><ul><li><code>WX_ROBOT_KEY</code> 未配置或配置错误</li><li>机器人 Key 已过期</li><li>网络问题</li></ul><p><strong>解决方法</strong>：</p><ul><li>检查 GitHub Secret 配置</li><li>重新获取机器人 Key</li><li>查看 Actions 日志中的错误信息</li></ul><h3 id="问题-3-依赖安装失败" tabindex="-1">问题 3：依赖安装失败 <a class="header-anchor" href="#问题-3-依赖安装失败" aria-label="Permalink to &quot;问题 3：依赖安装失败&quot;">​</a></h3><p><strong>可能原因</strong>：</p><ul><li><code>package.json</code> 中的依赖版本问题</li><li>npm 源访问问题</li></ul><p><strong>解决方法</strong>：</p><ul><li>检查 <code>package.json</code> 配置</li><li>在工作流中添加 npm 源配置</li></ul><h2 id="📝-注意事项" tabindex="-1">📝 注意事项 <a class="header-anchor" href="#📝-注意事项" aria-label="Permalink to &quot;📝 注意事项&quot;">​</a></h2><ol><li><p><strong>GitHub Actions 免费额度</strong>：</p><ul><li>公开仓库：无限制</li><li>私有仓库：每月 2000 分钟免费额度</li></ul></li><li><p><strong>Cron 执行时间</strong>：</p><ul><li>GitHub Actions 的 cron 可能有几分钟的延迟</li><li>使用 UTC 时间，需要转换为本地时间</li></ul></li><li><p><strong>安全性</strong>：</p><ul><li>不要在代码中硬编码机器人 Key</li><li>使用 GitHub Secrets 存储敏感信息</li></ul></li><li><p><strong>调试建议</strong>：</p><ul><li>先手动触发测试</li><li>查看完整的执行日志</li><li>确认所有依赖都已正确安装</li></ul></li></ol><h2 id="🎯-最佳实践" tabindex="-1">🎯 最佳实践 <a class="header-anchor" href="#🎯-最佳实践" aria-label="Permalink to &quot;🎯 最佳实践&quot;">​</a></h2><ol><li><strong>定期检查</strong>：定期查看 Actions 执行情况，确保正常运行</li><li><strong>日志监控</strong>：如果连续失败，及时查看日志并修复</li><li><strong>版本管理</strong>：保持依赖版本稳定，避免频繁更新</li><li><strong>备份方案</strong>：可以同时配置本地 cron 作为备份</li></ol><h2 id="📚-相关资源" tabindex="-1">📚 相关资源 <a class="header-anchor" href="#📚-相关资源" aria-label="Permalink to &quot;📚 相关资源&quot;">​</a></h2><ul><li><a href="https://docs.github.com/en/actions" target="_blank" rel="noreferrer">GitHub Actions 官方文档</a></li><li><a href="https://crontab.guru/" target="_blank" rel="noreferrer">Cron 表达式生成器</a></li><li><a href="https://developer.work.weixin.qq.com/document/path/91770" target="_blank" rel="noreferrer">企业微信机器人文档</a></li></ul>`,54)]))}const g=l(e,[["render",r]]);export{p as __pageData,g as default};
