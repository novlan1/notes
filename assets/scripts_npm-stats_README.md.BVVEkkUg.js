import{_ as i,c as a,o as n,a2 as l}from"./chunks/framework.CriqKoQt.js";const E=JSON.parse('{"title":"NPM 下载量统计脚本","description":"","frontmatter":{},"headers":[],"relativePath":"scripts/npm-stats/README.md","filePath":"scripts/npm-stats/README.md","lastUpdated":1770284758000}'),t={name:"scripts/npm-stats/README.md"};function h(e,s,p,k,o,d){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="npm-下载量统计脚本" tabindex="-1">NPM 下载量统计脚本 <a class="header-anchor" href="#npm-下载量统计脚本" aria-label="Permalink to &quot;NPM 下载量统计脚本&quot;">​</a></h1><p>这个脚本用于统计指定 npm 包的下载量，并通过企业微信机器人发送统计报告。</p><h2 id="功能特性" tabindex="-1">功能特性 <a class="header-anchor" href="#功能特性" aria-label="Permalink to &quot;功能特性&quot;">​</a></h2><ul><li>✅ 统计每日（昨日）下载量</li><li>✅ 统计每周（近7天）下载量</li><li>✅ 统计每月（近30天）下载量</li><li>✅ 自动生成 Markdown 格式的统计报告</li><li>✅ 通过企业微信机器人发送报告</li><li>✅ 支持多个 npm 包同时统计</li><li>✅ 自动排序和趋势分析</li></ul><h2 id="使用方法" tabindex="-1">使用方法 <a class="header-anchor" href="#使用方法" aria-label="Permalink to &quot;使用方法&quot;">​</a></h2><h3 id="_1-配置环境变量" tabindex="-1">1. 配置环境变量 <a class="header-anchor" href="#_1-配置环境变量" aria-label="Permalink to &quot;1. 配置环境变量&quot;">​</a></h3><p>在运行脚本前，需要设置企业微信机器人的 Key：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WX_ROBOT_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-robot-key-here&quot;</span></span></code></pre></div><p>或者在 <code>.env</code> 文件中配置：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">WX_ROBOT_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-robot-key-here</span></span></code></pre></div><h3 id="_2-运行脚本" tabindex="-1">2. 运行脚本 <a class="header-anchor" href="#_2-运行脚本" aria-label="Permalink to &quot;2. 运行脚本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 直接运行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/npm-stats/npm-download-stats.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或者添加到 package.json 的 scripts 中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stats</span></span></code></pre></div><h3 id="_3-定时任务" tabindex="-1">3. 定时任务 <a class="header-anchor" href="#_3-定时任务" aria-label="Permalink to &quot;3. 定时任务&quot;">​</a></h3><h4 id="方式一-使用-github-actions-推荐" tabindex="-1">方式一：使用 GitHub Actions（推荐） <a class="header-anchor" href="#方式一-使用-github-actions-推荐" aria-label="Permalink to &quot;方式一：使用 GitHub Actions（推荐）&quot;">​</a></h4><p>项目已配置 GitHub Actions 工作流（<code>.github/workflows/npm-stats.yml</code>），会自动执行以下任务：</p><ul><li><strong>自动执行</strong>：每天早上 9:00（北京时间）自动运行</li><li><strong>手动触发</strong>：在 GitHub Actions 页面可以手动触发运行</li><li><strong>配置方法</strong>： <ol><li>在 GitHub 仓库的 Settings → Secrets and variables → Actions 中添加密钥</li><li>添加名为 <code>WX_ROBOT_KEY</code> 的 Secret，值为企业微信机器人的 Key</li><li>提交代码后，工作流会自动生效</li></ol></li></ul><p><strong>手动触发方式</strong>：</p><ol><li>进入 GitHub 仓库的 Actions 页面</li><li>选择 &quot;NPM Download Statistics&quot; 工作流</li><li>点击 &quot;Run workflow&quot; 按钮</li></ol><h4 id="方式二-使用本地-cron" tabindex="-1">方式二：使用本地 Cron <a class="header-anchor" href="#方式二-使用本地-cron" aria-label="Permalink to &quot;方式二：使用本地 Cron&quot;">​</a></h4><p>可以使用 cron 或其他定时任务工具定期运行脚本：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 每天早上 9 点执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /path/to/notes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/npm-stats/npm-download-stats.js</span></span></code></pre></div><h2 id="配置说明" tabindex="-1">配置说明 <a class="header-anchor" href="#配置说明" aria-label="Permalink to &quot;配置说明&quot;">​</a></h2><h3 id="修改统计的包列表" tabindex="-1">修改统计的包列表 <a class="header-anchor" href="#修改统计的包列表" aria-label="Permalink to &quot;修改统计的包列表&quot;">​</a></h3><p>编辑 <code>npm-download-stats.js</code> 文件中的 <code>PACKAGES</code> 数组：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PACKAGES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;press-ui&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;t-comm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;tdesign-uniapp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 添加更多包...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><h3 id="企业微信机器人配置" tabindex="-1">企业微信机器人配置 <a class="header-anchor" href="#企业微信机器人配置" aria-label="Permalink to &quot;企业微信机器人配置&quot;">​</a></h3><ol><li>在企业微信群中添加机器人</li><li>获取机器人的 Webhook Key</li><li>设置环境变量 <code>WX_ROBOT_KEY</code></li></ol><h2 id="报告示例" tabindex="-1">报告示例 <a class="header-anchor" href="#报告示例" aria-label="Permalink to &quot;报告示例&quot;">​</a></h2><p>脚本会生成如下格式的报告：</p><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;"># NPM 下载量统计报告</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">&gt; 统计时间：2026/02/05</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 📊 昨日下载量</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| 包名 | 下载量 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|------|--------|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| press-ui | 1,234 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| t-comm | 567 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| tdesign-uniapp | 890 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| </span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**总计**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | </span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**2,691**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 📈 近7天下载量</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| 包名 | 下载量 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|------|--------|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| press-ui | 8,640 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| t-comm | 3,969 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| tdesign-uniapp | 6,230 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| </span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**总计**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | </span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**18,839**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 📅 近30天下载量</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| 包名 | 下载量 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|------|--------|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| press-ui | 37,020 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| t-comm | 17,010 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| tdesign-uniapp | 26,700 |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| </span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**总计**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | </span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**80,730**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 📊 趋势分析</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 昨日总下载量：2,691</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 近7天日均下载量：2,691</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 近30天日均下载量：2,691</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">🏆 </span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**本月下载量冠军**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：press-ui（37,020 次）</span></span></code></pre></div><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><ol><li>NPM API 有速率限制，建议不要频繁调用</li><li>如果未配置企业微信机器人 Key，报告会输出到控制台</li><li>脚本会自动处理网络错误，失败的包下载量会显示为 0</li><li>统计数据来自 NPM 官方 API，可能有延迟</li></ol><h2 id="依赖说明" tabindex="-1">依赖说明 <a class="header-anchor" href="#依赖说明" aria-label="Permalink to &quot;依赖说明&quot;">​</a></h2><ul><li><code>https</code>: Node.js 内置模块，用于发起 HTTP 请求</li><li><code>t-comm</code>: 用于发送企业微信消息的工具库</li></ul><h2 id="故障排查" tabindex="-1">故障排查 <a class="header-anchor" href="#故障排查" aria-label="Permalink to &quot;故障排查&quot;">​</a></h2><h3 id="问题-消息发送失败" tabindex="-1">问题：消息发送失败 <a class="header-anchor" href="#问题-消息发送失败" aria-label="Permalink to &quot;问题：消息发送失败&quot;">​</a></h3><ul><li>检查 <code>WX_ROBOT_KEY</code> 是否正确配置</li><li>检查网络连接是否正常</li><li>查看控制台输出的错误信息</li></ul><h3 id="问题-下载量显示为-0" tabindex="-1">问题：下载量显示为 0 <a class="header-anchor" href="#问题-下载量显示为-0" aria-label="Permalink to &quot;问题：下载量显示为 0&quot;">​</a></h3><ul><li>检查包名是否正确</li><li>检查 NPM API 是否可访问</li><li>可能是该包在统计时间段内确实没有下载量</li></ul><h2 id="扩展功能" tabindex="-1">扩展功能 <a class="header-anchor" href="#扩展功能" aria-label="Permalink to &quot;扩展功能&quot;">​</a></h2><p>可以根据需要扩展以下功能：</p><ol><li>添加更多统计维度（如按版本统计）</li><li>生成图表（使用 Chart.js 等库）</li><li>保存历史数据到数据库</li><li>添加同比、环比分析</li><li>支持多个机器人同时发送</li></ol>`,42)]))}const c=i(t,[["render",h]]);export{E as __pageData,c as default};
