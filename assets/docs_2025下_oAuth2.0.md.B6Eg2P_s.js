import{_ as a,c as e,o as i,a2 as n}from"./chunks/framework.CriqKoQt.js";const k=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2025下/oAuth2.0.md","filePath":"docs/2025下/oAuth2.0.md","lastUpdated":1771946197000}'),t={name:"docs/2025下/oAuth2.0.md"};function p(o,s,l,c,d,h){return i(),e("div",null,s[0]||(s[0]=[n(`<h2 id="_1-oauth2-0" tabindex="-1">1. OAuth2.0 <a class="header-anchor" href="#_1-oauth2-0" aria-label="Permalink to &quot;1. OAuth2.0&quot;">​</a></h2><p>OAuth 的<strong>核心就是向第三方应用颁发令牌</strong>。</p><p>OAuth 2.0 规定了四种获得令牌的流程。你可以选择最适合自己的那一种，向第三方应用颁发令牌。</p><p>下面就是这四种授权方式。</p><ol><li>授权码 （<code>authorization-code</code>）</li><li>隐藏式 （<code>implicit</code>）</li><li>密码式（<code>password</code>）</li><li>客户端凭证（<code>client Credentials</code>）</li></ol><p>注意，不管哪一种授权方式，第三方应用申请令牌之前，都必须先到系统备案，说明自己的身份，然后会拿到两个身份识别码：<strong>客户端 ID （client ID） 和客户端密钥（client secret）</strong>。这是为了防止令牌被滥用，没有备案过的第三方应用，是不会拿到令牌的</p><h2 id="_2-授权码形式的-oauth2-0" tabindex="-1">2. 授权码形式的 OAuth2.0 <a class="header-anchor" href="#_2-授权码形式的-oauth2-0" aria-label="Permalink to &quot;2. 授权码形式的 OAuth2.0&quot;">​</a></h2><p><strong>就是第三方应用先申请一个授权码，然后再用该码获取令牌</strong>。</p><p>第一步，A 网站提供一个链接，用户点击后就会跳转到 B 网站，授权用户数据给 A 网站使用。下面就是 A 网站跳转 B 网站的一个示意链接。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://b.com/oauth/authorize?</span></span>
<span class="line"><span>  response_type=code&amp;</span></span>
<span class="line"><span>  client_id=CLIENT_ID&amp;</span></span>
<span class="line"><span>  redirect_uri=CALLBACK_URL&amp;</span></span>
<span class="line"><span>  scope=read</span></span></code></pre></div><p>上面 URL 中，<code>response_type</code> 参数表示要求返回授权码（<code>code</code>），<code>client_id</code> 参数让 B 知道是谁在请求，<code>redirect_uri</code> 参数是 B 接受或拒绝请求后的跳转网址，<code>scope</code> 参数表示要求的授权范围（这里是只读）。</p><p>第二步，用户跳转后，B 网站会要求用户登录，然后询问是否同意给予 A 网站授权。用户表示同意，这时 B 网站就会跳回 <code>redirect_uri</code> 参数指定的网址。跳转时，会传回一个授权码，就像下面这样。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://a.com/callback?code=AUTHORIZATION_CODE</span></span></code></pre></div><p>上面 URL 中，<code>code</code> 参数就是授权码。</p><p>第三步，A 网站拿到授权码以后，就可以在后端，向 B 网站请求令牌。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://b.com/oauth/token?</span></span>
<span class="line"><span> client_id=CLIENT_ID&amp;</span></span>
<span class="line"><span> client_secret=CLIENT_SECRET&amp;</span></span>
<span class="line"><span> grant_type=authorization_code&amp;</span></span>
<span class="line"><span> code=AUTHORIZATION_CODE&amp;</span></span>
<span class="line"><span> redirect_uri=CALLBACK_URL</span></span></code></pre></div><p>上面 URL 中，<code>client_id</code> 参数和 <code>client_secret</code> 参数用来让 B 确认 A 的身份（<code>client_secret</code> 参数是保密的，因此只能在后端发请求），<code>grant_type</code> 参数的值是<code>AUTHORIZATION_CODE</code>，表示采用的授权方式是授权码，<code>code</code> 参数是上一步拿到的授权码，<code>redirect_uri</code> 参数是令牌颁发后的回调网址。</p><p>第四步，B 网站收到请求以后，就会颁发令牌。具体做法是向 <code>redirect_uri</code> 指定的网址，发送一段 JSON 数据。</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;access_token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ACCESS_TOKEN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;token_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bearer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;expires_in&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2592000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;refresh_token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;REFRESH_TOKEN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scope&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;read&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;uid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100101</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:{</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>上面 JSON 数据中，<code>access_token</code> 字段就是令牌，A 网站在后端拿到了。</p><h2 id="_3-令牌与密码" tabindex="-1">3. 令牌与密码 <a class="header-anchor" href="#_3-令牌与密码" aria-label="Permalink to &quot;3. 令牌与密码&quot;">​</a></h2><p>令牌（<code>token</code>）与密码（<code>password</code>）的作用是一样的，都可以进入系统，但是有三点差异。</p><p>（1）令牌是短期的，到期会自动失效，用户自己无法修改。密码一般长期有效，用户不修改，就不会发生变化。</p><p>（2）令牌可以被数据所有者撤销，会立即失效。以上例而言，屋主可以随时取消快递员的令牌。密码一般不允许被他人撤销。</p><p>（3）令牌有权限范围（<code>scope</code>），比如只能进小区的二号门。对于网络服务来说，只读令牌就比读写令牌更安全。 密码一般是完整权限。</p><p>上面这些设计，保证了令牌既可以让第三方应用获得权限，同时又随时可控，不会危及系统安全。这就是OAuth 2.0的优点。</p><h2 id="_4-令牌的使用" tabindex="-1">4. 令牌的使用 <a class="header-anchor" href="#_4-令牌的使用" aria-label="Permalink to &quot;4. 令牌的使用&quot;">​</a></h2><p>A 网站拿到令牌以后，就可以向 B 网站的 API 请求数据了。</p><p>此时，每个发到 API 的请求，都必须带有令牌。具体做法是在请求的头信息，加上一个 <code>Authorization</code> 字段，令牌就放在这个字段里面。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>curl -H &quot;Authorization: Bearer ACCESS_TOKEN&quot; \\</span></span>
<span class="line"><span>&quot;https://api.b.com&quot;</span></span></code></pre></div><p>上面命令中，<code>ACCESS_TOKEN</code> 就是拿到的令牌。</p><h2 id="_5-更新令牌" tabindex="-1">5. 更新令牌 <a class="header-anchor" href="#_5-更新令牌" aria-label="Permalink to &quot;5. 更新令牌&quot;">​</a></h2><p>令牌的有效期到了，如果让用户重新走一遍上面的流程，再申请一个新的令牌，很可能体验不好，而且也没有必要。OAuth 2.0 允许用户自动更新令牌。</p><p>具体方法是，B 网站颁发令牌的时候，一次性颁发两个令牌，一个用于获取数据，另一个用于获取新的令牌（<code>refresh token</code> 字段）。令牌到期前，用户使用 <code>refresh token</code> 发一个请求，去更新令牌。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://b.com/oauth/token?</span></span>
<span class="line"><span>  grant_type=refresh_token&amp;</span></span>
<span class="line"><span>  client_id=CLIENT_ID&amp;</span></span>
<span class="line"><span>  client_secret=CLIENT_SECRET&amp;</span></span>
<span class="line"><span>  refresh_token=REFRESH_TOKEN</span></span></code></pre></div><p>上面 URL 中，<code>grant_type</code> 参数为 <code>refresh_token</code> 表示要求更新令牌，<code>client_id</code> 参数和 <code>client_secret</code> 参数用于确认身份，<code>refresh_token</code> 参数就是用于更新令牌的令牌。</p><p>B 网站验证通过以后，就会颁发新的令牌。</p>`,37)]))}const u=a(t,[["render",p]]);export{k as __pageData,u as default};
