import{_ as s,c as a,o as i,ag as e}from"./chunks/framework.6d7lLjym.js";const c=JSON.parse('{"title":"圈复杂度","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2025下/complexity.md","filePath":"docs/2025下/complexity.md","lastUpdated":1764772784000}'),d={name:"docs/2025下/complexity.md"};function l(p,t,h,n,r,o){return i(),a("div",null,t[0]||(t[0]=[e(`<h1 id="圈复杂度" tabindex="-1">圈复杂度 <a class="header-anchor" href="#圈复杂度" aria-label="Permalink to &quot;圈复杂度&quot;">​</a></h1><h2 id="什么是代码圈复杂度" tabindex="-1">什么是代码圈复杂度 <a class="header-anchor" href="#什么是代码圈复杂度" aria-label="Permalink to &quot;什么是代码圈复杂度&quot;">​</a></h2><p>也许大家对到底是什么使得程序变得更复杂或更简单有直观的感觉。研究人员已经总结出一些衡量复杂度的方法，最著名的可能就是 Tom McCabe 的方法了，该方法通过计算子程序中的“决策点（decision points）”的数量来衡量复杂度。以下给出了一种用于计算决策点的方法：</p><ol><li>从1开始，一直往下通过程序</li><li>一但遇到以下关键字，或者其它同类的词，就加1：if，while，repeat，for，and，or</li><li>给case语句中的每一种情况都加1</li></ol><p>下面举一个例子：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">（（（status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> success） and done） or</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">（not done and （numLines </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">maxLines ））） then…</span></span></code></pre></div><p>在这段代码中，从1算起，遇到if得2，and得3，or得4，and得5。加起来，这段代码里总共包含了5个决策点。</p><p>简单的说，代码圈复杂度是用来衡量一个函数判定结构复杂程度的指标。函数的复杂度在很大程度上决定了理解程序所需要花费的精力。很多年前，已经有专家对复杂度的危险提出警告：“有能力的程序员会充分的认识到自己的大脑容量是多么的有限，所以，他会非常谦卑的处理编程任务”。这并不是说我们得增加自己的脑容量才能应对巨大的复杂度，还有一种方法是尽可能的采取措施来降低复杂度。</p><p>同时，虽然高复杂度的函数不一定就会出错，但相比低复杂度的函数来说，可读性比较差，存在缺陷风险会比较高，而且难于测试和维护，用例难以全面覆盖，增加新人熟悉业务难度，在新增功能、定位问题和修复Bug时，所耗费的人力成会很高。</p><p>使用圈复杂度检查工具，相当于给代码安装了指示器，提醒我们哪些程序方法存在高复杂度的风险。圈复杂度可以成为编码及重构的重要参考指标，指导撰写可读性高的代码。</p><h2 id="复杂度多少算正常" tabindex="-1">复杂度多少算正常 <a class="header-anchor" href="#复杂度多少算正常" aria-label="Permalink to &quot;复杂度多少算正常&quot;">​</a></h2><p>复杂度数值的高与低，没有一个所谓的硬性标准，业界普遍认为，复杂度为10及以下的函数可读性好，容易测试，且存在缺陷风险几率较低。</p><table tabindex="0"><thead><tr><th>圈复杂度</th><th>代码状况</th><th>可测性</th><th>维护成本</th></tr></thead><tbody><tr><td>1-10</td><td>清晰、结构化</td><td>高</td><td>低</td></tr><tr><td>11-20</td><td>复杂</td><td>中</td><td>中</td></tr><tr><td>21-30</td><td>非常复杂</td><td>低</td><td>高</td></tr><tr><td>&gt;30</td><td>不可读</td><td>不可测</td><td>非常高</td></tr></tbody></table><p>10个以上节点作为复杂度上限并不是绝对的，应该把节点数量当做是一个警示，该警示说明某个子程序可能需要重新设计了。</p><h2 id="lizard" tabindex="-1">lizard <a class="header-anchor" href="#lizard" aria-label="Permalink to &quot;lizard&quot;">​</a></h2><p><a href="https://pypi.org/project/lizard/" target="_blank" rel="noreferrer">lizard</a> 是一个好用的工具，CodeCC 也是采用的这个。</p><p>名称解释</p><table tabindex="0"><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>NLOC</td><td>函数的非注释代码行数</td></tr><tr><td>CCN</td><td>圈复杂度</td></tr><tr><td>token</td><td>函数中的 token 数量（关键字、标识符等）</td></tr><tr><td>PARAM</td><td>函数的参数个数</td></tr><tr><td>function_name</td><td>函数名</td></tr><tr><td>start_line</td><td>函数起始行号</td></tr><tr><td>end_line</td><td>函数结束行号</td></tr><tr><td>file_path</td><td>文件路径</td></tr></tbody></table><p>安装</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lizard</span></span></code></pre></div><p>分析复杂度</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lizard</span></span></code></pre></div><p>输出 html 格式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lizard</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> report.html</span></span></code></pre></div><p>输出 csv 格式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lizard</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --csv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> report.csv</span></span></code></pre></div><p>过滤文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lizard</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> one-file.js</span></span></code></pre></div><p>过滤目录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lizard</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./.vitepress/*&quot;</span></span></code></pre></div><p>排序</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按照复杂度降序</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lizard</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cyclomatic_complexity</span></span></code></pre></div><p>参考：</p><ul><li><a href="https://kaelzhang81.github.io/2017/06/18/%E8%AF%A6%E8%A7%A3%E5%9C%88%E5%A4%8D%E6%9D%82%E5%BA%A6/" target="_blank" rel="noreferrer">https://kaelzhang81.github.io/2017/06/18/详解圈复杂度/</a></li></ul>`,34)]))}const g=s(d,[["render",l]]);export{c as __pageData,g as default};
