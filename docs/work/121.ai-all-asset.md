## 1. 位图

### 1.1. 问题

> 痛点1：手动在视觉设计稿中切图（用作项目静态图片或动态图片）——> 手动上传到 cos git 仓库、触发流水线上传到业务 cos 桶或手动直接上传到业务 cos 桶
>
> 痛点2：部分没接入 cos git 的业务，手动直达上传到业务cos桶，仍然需要肉眼检查图片是否重命名(不检测的话，覆盖线上资源会导致业务事故)

### 1.2. 优化

1. 提供 `upload-mcp` 工具，IDE 中一键上传
2. 自动压缩图片
3. 自动同步 `cos.git` 仓库，方便后续修改

已有

1. 通过 `cos.git` 上传
2. 通过在线工具上传

`mcp` 上传流程

```mermaid
graph LR
mcp -- tinypng --> compressed
compressed --upload--> cos
cos --回写--> git
```

修改时

```mermaid
graph LR
git --提交--> cos
```

注意，由于 COS 的 `open api` 限制一个前缀目录下只能拉取 1000 个文件，所以建议一个目录不要放太多东西。

在 `cos.git` 的 [.cos/sync.config.js](https://git.woa.com/pmd-mobile/pmd-h5/cos/blob/master/.cos/sync.config.js) 文件中存放要拉取的前缀列表，如

```js
module.exports = {
  getBucketLitPrefixList: {
    'image-1251917893': [
      'general-match/',
      'pmd-icon/',
    ],
  },
};
```

### 1.3. 三位一体

```mermaid
graph TD

在线网站 --> COS
cos.git --> COS
MCP --> COS
```

想用啥就用啥，喜欢用啥就用啥。

## 2. iconfont 图标

### 2.1. 问题

> 痛点1：手动下载svg ——> 手动上传到 cosdesign
>
> 痛点2：每次更新需肉眼检测图标是否重名，耗时耗力
>
> 痛点3：目前发现部分SVG文件上传至 codesign 后，会出现内容丢失或显示异常的问题。视觉同学通常无法定位具体原因，只能通过反复试错的方式将文件交由我们排查，这会占用我们不少时间（比如此前 x 项目中，遇到过不少图标出现此类问题，可能会花费时间协助检查和调整图标）。为了提升效率，期待提供一个 SVG 预览页面：视觉同学上传 SVG 文件后，页面可直接渲染展示效果，让他们能自主试错、调整图标并定位问题根源，减少对开发侧的依赖。

### 2.2. 优化

1. 支持自动下载 `figma` 中 `svg`，生成 `iconfont` 等
2. 支持在线工具预览、下载

> 核心：全自动化、流程左移、安全

注意，这里是没有 MCP 的，**全自动化比 AI 更进一步**，只要源头数据是正确的，根本无需任何操作。

```mermaid
graph TD
figma --自动下载 svg--> git
git --> json["json"]
git --> iconfont["iconfont 字体"]
iconfont --> cdn
git --> css

git --> js
css --> cdn
js --> cdn
json --> cdn
cdn --> 在线网站

git --> demo

demo ----> 在线网站


在线网站 --> 预览
在线网站 --> 复制
在线网站 --> 下载
在线网站 --> 搜索
```

操作节点

```mermaid
graph LR
创建项目 --研发平台--> 初始化/更新 --"figma to svg"--> 审核 --"svg to iconfont"-->  审核/查看 --发布--> 验证
```

涉及内容较多

1. `figma` 中 `svg` 下载
2. `git` 存储
3. `svg` 生成 `iconfont` 字体、CSS
4. 上传 CSS/字体 到 `cos`
5. 网站拉取
6. `cos` 同步到 `git`

还有工程方面的：

1. 图标工程创建
2. 图标工程管理
3. 手动触发更新
4. 更新时发MR及审核

`icon.git` 功能

1. 执行 `svg` 手动更新，创建 MR 到 `master`
2. 执行 `iconfont` 生成，创建 MR，从 `master` 到 `release`
3. 执行上传 CDN，`release` 分支上进行

### 2.3. 操作指南

#### 2.3.1. 新建项目

研发平台点击“新建图标项目”，填写表单并提交。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_GNWCcQwdCDE4SQhy.png" width="700" />

#### 2.3.2. 项目管理

研发平台点击“图标项目管理”，可以编辑项目、查看图标、更新图标、复制样式链接等。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_yitDy7K56Q7yCtnx.png" width="700" />

#### 2.3.3. 图标查看

点击项目卡片，可以进入项目图标示例页面，如 [https://mobile.woa.com/pmd-icon/match-common/demo.html](https://mobile.woa.com/pmd-icon/match-common/demo.html)，可进行 `svg/class/unicode` 不同形式的查看和校验。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_riaKAiK8ypCAZSG4.png" width="700" />

项目卡片下方有图标CSS链接，如 [https://image-1251917893.file.myqcloud.com/pmd-icon/match-common/pmg-iconfont.css](https://image-1251917893.file.myqcloud.com/pmd-icon/match-common/pmg-iconfont.css)，点击即可复制。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_FNFaiQ6xHSY7QJiz.png" width="700" />

#### 2.3.4. 图标更新

项目卡片右上角点击“更新”，会触发[流水线](https://devops.woa.com/console/pipeline/tip-h5/p-c988624124334c24b6872b10053c763e/history/history/4?page=1&pageSize=20)，进行图标的更新或初始化。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_DZpz5NszjiMebNMx.png" width="700" />

该流水线会创建一个[icon.git](https://git.woa.com/pmd-mobile/pmd-h5/icon)的 MR，开发人员可以查看 SVG 列表是否符合预期，如 [https://git.woa.com/pmd-mobile/pmd-h5/icon/-/merge_requests/1](https://git.woa.com/pmd-mobile/pmd-h5/icon/-/merge_requests/1)。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_Cp5CJkAmfThK38Jj.png" width="700" />

#### 2.3.5. 字体、CSS 更新

上面 MR 通过后，自动触发 `svg` 转 `iconfont` 流程，并上传预览页面到内网，以及创建 `master` 到 `release` 的MR，通过会才会同步到 CDN。

这里的审核会为了防止生成的 `iconfont` 不符合预期，避免引起线上问题。

举例，[https://git.woa.com/pmd-mobile/pmd-h5/icon/-/merge_requests/2](https://git.woa.com/pmd-mobile/pmd-h5/icon/-/merge_requests/2)。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_WkdmNAbxtf7zsGKS.png" width="700" />

### 2.4. 迁移建议

1. 新项目建议使用这套图标库，全自动化
2. 老项目，如果还在频繁更新的话，也建议早点迁移、做验证
3. 老项目，不咋更新的，就没有迁移的必要了

### 2.5. FAQ

1. 类名会不会重复

基于流程整体左移的思路，由设计师保证不重复，由于在一张画布或一个 `figma` 文件中，能较轻松找到哪个重复。

对于语义确实重复的，可以添加 `-1`、`-2` 等标识，比如 `edit-1`、`edit-2`。

2. 图标黑框

检查是不是设置了 `clip content`，需要去掉。

3. 上传到 `devcloud` 失败

~~新增的项目可能需要登录 `devcloud` 手动新增一个目录。~~ 已使用流水线解决。

4. 有没有刷新 CDN 缓存

有。

上传的所有文件，包括位图、图标、字体、其他文件等，使用的所有方式，包括在线网站、MCP、`cos.git` 等，都会进行 CDN 缓存刷新！

## 3. 字体

### 3.1. 问题

> 痛点：手动处理(需使用font-spider进行特殊字体压缩，然后利用其他工具进行字体多格式转换)设计师给到的全量字体包，对字体进行精简——> 上传到字体资源存储仓库，用作记录存储—— > 手动上传到业务cos桶

之前的压缩流程：https://doc.weixin.qq.com/doc/w3_AUgAMAa1AB47Xwn5SKNR0STF01euz?scode=AJEAIQdfAAoU2uNIqAAUgAMAa1AB4

### 3.2. 优化

用户上传全量字体包 ——> 输入对应文字 ——> 一键压缩 ——> 上传到 cos，并返回对应字体在线链接。

操作节点

```mermaid
graph LR
创建项目 --研发平台--> 初始化/更新 --fontmin--> 字体压缩 --上传--> 验证
```

无需手动多工具来回跳转，全部闭环操作。

几个核心点

1. 加载字体文件到 `document`
2. 为校验文字设置上传的字体

### 3.3. 操作指南

#### 3.3.1. 新建项目

研发平台点击“[新建字体项目](https://mobile.woa.com/rd-platform-web/#/font-project/new)”，填写表单并提交。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_DxkpGxEhEfAbtkyz.png" width="700" />

#### 3.3.2. 项目管理

研发平台点击“[字体项目管理](https://mobile.woa.com/rd-platform-web/#/font-project/list)”，可以编辑项目、复制字体链接等。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_T5ZeXJSdEbrppzyf.png" width="700" />

项目卡片下方有字体链接，如 [https://image-1251917893.file.myqcloud.com/pmd-font/gp-peace/peace.ttf](https://image-1251917893.file.myqcloud.com/pmd-font/gp-peace/peace.ttf)，点击即可复制。

#### 3.3.3. 字体项目更新

项目卡片右上角点击“编辑”，可进行字体项目的更新或初始化。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_MyYmsGWbFCGyBQcf.png" width="700" />

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_ATQ48yy6iKwXJkby.png" width="700" />

#### 3.3.4. 字体压缩

点击项目卡片，可以进入字体压缩页面，如 [https://mobile.woa.com/rd-platform-web/#/font-min?id=gp-peace](https://mobile.woa.com/rd-platform-web/#/font-min?id=gp-peace)，可进行字体压缩、上传。

<img src="https://cdn.uwayfly.com/article/2026/1/own_mike_3AiFwCHhzQbnNCh4.png" width="700" />

### 3.4. 图标和字体的不同

对比一下图标和字体设计上的不同

1. 图标由设计师在最上游处理好，重构、前端无需介入，全自动化，只需手动触发更新、审核即可
2. 字体需由重构或前端手动上传精简后的文字，这一步暂时无法取消。相应的，字体也不再需要两次审核，因为手动压缩的页面处已经相当于审核了，只要最终同步到 COS 后的校验即可
3. 图标项目需要有自己的 `git` 仓库，来保存无需上传到 COS 的 `svg` 文件等，而字体项目不需要，它没有中间文件，所有的字体文件都需要上传 COS，所以它不用新建仓库
4. 图标项目需要有自己的蓝盾流水线，用于执行拉取 SVG、生成 `iconfont`、创建 MR等，字体项目不需要

|类别|图标|字体|
|---|---|---|
|手动处理|无|有|
|多次审核|有|无|
|Git 仓库|有|无|
|流水线|有|无|
