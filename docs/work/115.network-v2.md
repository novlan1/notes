:::info 作者

novlan1

2025.12.29
:::

# Network V2 使用

## 优势

`pmd-network-v2` 相比 `pmd-network` 有以下优势

1. 支持异步拦截器
2. QQ内打开微信小程序时，支持选择QQ/微信登录

## 业务接入流程

1. 升级对应的项目公共配置

|项目类型|公共配置包|
|---|---|
|uniapp Vue2|`pnpm i @tencent/project-config-uni-vue@latest`|
|uniapp Vue3|`pnpm i @tencent/project-config-uni-vite@latest`|
|Vue2|`pnpm i @tencent/project-config-vue@latest`|
|Vue3|`pnpm i @tencent/project-config-vite@latest`|
|Pixui|`pnpm i @tencent/project-config-pixui@latest`|

2. 项目公共配置传入 `usePMDNetworkV2` 为 `true`

```ts
// 不同项目类型使用不同的方法
getUniVue3ViteConfig({
  // ...
  // 其他参数
  usePMDNetworkV2: true,
})
```

3. 升级 `pmd` 依赖
4. 如果业务中有单独引入 `pmd-vue/lib/network` 或 `pmd-business/lib/network` 中的方法或类，改成引入 `pmd-business/lib/network-v2`

```diff
- import xx from '@tencent/pmd-vue/lib/network/xx'
- import xx from '@tencent/pmd-business/lib/network/xx'
+ import xx from '@tencent/pmd-business/lib/network-v2/xx'
```

## 说明

1. 采用渐进升级，老项目可继续使用 `network v1`
2. `network v1` 不再支持修改，修改需要在 `v2` 版本上进行，并参考上面方式在业务中升级到 `network v2`
3. `src/api` 使用了 `network v1`，所以需要升级 `project-config-x`，进行 `usePMDNetworkV2` 的配置
